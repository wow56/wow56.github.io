<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL 进阶 | Wow56 个人知识库</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/flaglogo.png">
    <link rel="manifest" href="/flaglogo.png">
    <link rel="apple-touch-icon" href="/flaglogo.png">
    <meta name="description" content="Never stop learning">
    
    <link rel="preload" href="/assets/css/0.styles.b25eaea0.css" as="style"><link rel="preload" href="/assets/js/app.5780eb53.js" as="script"><link rel="preload" href="/assets/js/2.e1f1d232.js" as="script"><link rel="preload" href="/assets/js/7.de70efc4.js" as="script"><link rel="prefetch" href="/assets/js/10.921c058c.js"><link rel="prefetch" href="/assets/js/100.678efb16.js"><link rel="prefetch" href="/assets/js/101.6fd33b9c.js"><link rel="prefetch" href="/assets/js/102.dfa6e733.js"><link rel="prefetch" href="/assets/js/103.4b74461a.js"><link rel="prefetch" href="/assets/js/104.603354fe.js"><link rel="prefetch" href="/assets/js/105.9da719c4.js"><link rel="prefetch" href="/assets/js/106.6aa24318.js"><link rel="prefetch" href="/assets/js/107.5ea57319.js"><link rel="prefetch" href="/assets/js/108.37ded6f2.js"><link rel="prefetch" href="/assets/js/109.adc40804.js"><link rel="prefetch" href="/assets/js/11.00deed7e.js"><link rel="prefetch" href="/assets/js/110.f1791c33.js"><link rel="prefetch" href="/assets/js/111.bff2cea6.js"><link rel="prefetch" href="/assets/js/112.4eb7e8b1.js"><link rel="prefetch" href="/assets/js/113.4ca0e39f.js"><link rel="prefetch" href="/assets/js/114.03d070d7.js"><link rel="prefetch" href="/assets/js/115.a007d470.js"><link rel="prefetch" href="/assets/js/116.027c798b.js"><link rel="prefetch" href="/assets/js/117.6eaa95a7.js"><link rel="prefetch" href="/assets/js/118.3468f2af.js"><link rel="prefetch" href="/assets/js/119.94c060f2.js"><link rel="prefetch" href="/assets/js/12.e7e7feff.js"><link rel="prefetch" href="/assets/js/120.2639e06f.js"><link rel="prefetch" href="/assets/js/121.1ee7e578.js"><link rel="prefetch" href="/assets/js/122.d1f0654b.js"><link rel="prefetch" href="/assets/js/123.52d57be3.js"><link rel="prefetch" href="/assets/js/124.d515f509.js"><link rel="prefetch" href="/assets/js/125.c783db82.js"><link rel="prefetch" href="/assets/js/126.08d41fac.js"><link rel="prefetch" href="/assets/js/127.5ab5b3c5.js"><link rel="prefetch" href="/assets/js/13.c0e1c39d.js"><link rel="prefetch" href="/assets/js/14.4be8face.js"><link rel="prefetch" href="/assets/js/15.b235fe5f.js"><link rel="prefetch" href="/assets/js/16.a62bd2ec.js"><link rel="prefetch" href="/assets/js/17.d3fa5b5a.js"><link rel="prefetch" href="/assets/js/18.04056df6.js"><link rel="prefetch" href="/assets/js/19.e0daa831.js"><link rel="prefetch" href="/assets/js/20.aae5efb2.js"><link rel="prefetch" href="/assets/js/21.51bfd139.js"><link rel="prefetch" href="/assets/js/22.d92aecaf.js"><link rel="prefetch" href="/assets/js/23.fd2079a6.js"><link rel="prefetch" href="/assets/js/24.7cadaa30.js"><link rel="prefetch" href="/assets/js/25.38c9c1a4.js"><link rel="prefetch" href="/assets/js/26.1c8277a8.js"><link rel="prefetch" href="/assets/js/27.1e495f81.js"><link rel="prefetch" href="/assets/js/28.7ef5af76.js"><link rel="prefetch" href="/assets/js/29.9031cb92.js"><link rel="prefetch" href="/assets/js/3.93a08b3b.js"><link rel="prefetch" href="/assets/js/30.1b61bbf8.js"><link rel="prefetch" href="/assets/js/31.f8cbfd44.js"><link rel="prefetch" href="/assets/js/32.0632cb94.js"><link rel="prefetch" href="/assets/js/33.a46a0b3d.js"><link rel="prefetch" href="/assets/js/34.fba531e6.js"><link rel="prefetch" href="/assets/js/35.db1fd348.js"><link rel="prefetch" href="/assets/js/36.9e6108c6.js"><link rel="prefetch" href="/assets/js/37.35fca0f6.js"><link rel="prefetch" href="/assets/js/38.ac22df93.js"><link rel="prefetch" href="/assets/js/39.7cce2902.js"><link rel="prefetch" href="/assets/js/4.e30be376.js"><link rel="prefetch" href="/assets/js/40.3560e650.js"><link rel="prefetch" href="/assets/js/41.d4632345.js"><link rel="prefetch" href="/assets/js/42.adce46c5.js"><link rel="prefetch" href="/assets/js/43.d2ff2a7e.js"><link rel="prefetch" href="/assets/js/44.d3f6ac6e.js"><link rel="prefetch" href="/assets/js/45.1e3b049e.js"><link rel="prefetch" href="/assets/js/46.917a9a8a.js"><link rel="prefetch" href="/assets/js/47.5a73f25d.js"><link rel="prefetch" href="/assets/js/48.3b970b0a.js"><link rel="prefetch" href="/assets/js/49.dc6fd937.js"><link rel="prefetch" href="/assets/js/5.9411f932.js"><link rel="prefetch" href="/assets/js/50.109fdeb5.js"><link rel="prefetch" href="/assets/js/51.5ec4fc4b.js"><link rel="prefetch" href="/assets/js/52.0c03ff96.js"><link rel="prefetch" href="/assets/js/53.e91a6f48.js"><link rel="prefetch" href="/assets/js/54.7f886adb.js"><link rel="prefetch" href="/assets/js/55.2747b24f.js"><link rel="prefetch" href="/assets/js/56.a78db785.js"><link rel="prefetch" href="/assets/js/57.517d420c.js"><link rel="prefetch" href="/assets/js/58.0429f17c.js"><link rel="prefetch" href="/assets/js/59.9d68455f.js"><link rel="prefetch" href="/assets/js/6.3e126bb5.js"><link rel="prefetch" href="/assets/js/60.7cc000dc.js"><link rel="prefetch" href="/assets/js/61.8eaec827.js"><link rel="prefetch" href="/assets/js/62.9eb7a7b3.js"><link rel="prefetch" href="/assets/js/63.35e36177.js"><link rel="prefetch" href="/assets/js/64.6282d042.js"><link rel="prefetch" href="/assets/js/65.58ed4699.js"><link rel="prefetch" href="/assets/js/66.971cb02f.js"><link rel="prefetch" href="/assets/js/67.0a93b287.js"><link rel="prefetch" href="/assets/js/68.a7b05e3b.js"><link rel="prefetch" href="/assets/js/69.6572830f.js"><link rel="prefetch" href="/assets/js/70.168da9d9.js"><link rel="prefetch" href="/assets/js/71.d57d693b.js"><link rel="prefetch" href="/assets/js/72.91fa5cd3.js"><link rel="prefetch" href="/assets/js/73.7de2d2b8.js"><link rel="prefetch" href="/assets/js/74.acd298e4.js"><link rel="prefetch" href="/assets/js/75.62e67874.js"><link rel="prefetch" href="/assets/js/76.f2b96539.js"><link rel="prefetch" href="/assets/js/77.4255efc8.js"><link rel="prefetch" href="/assets/js/78.114300ba.js"><link rel="prefetch" href="/assets/js/79.d14a2756.js"><link rel="prefetch" href="/assets/js/8.1ec756ec.js"><link rel="prefetch" href="/assets/js/80.3fd73e00.js"><link rel="prefetch" href="/assets/js/81.71ebdbf4.js"><link rel="prefetch" href="/assets/js/82.0a5b5bb1.js"><link rel="prefetch" href="/assets/js/83.a23907a9.js"><link rel="prefetch" href="/assets/js/84.8c2bc996.js"><link rel="prefetch" href="/assets/js/85.ed1b9552.js"><link rel="prefetch" href="/assets/js/86.49d44a86.js"><link rel="prefetch" href="/assets/js/87.33153d90.js"><link rel="prefetch" href="/assets/js/88.a021dc21.js"><link rel="prefetch" href="/assets/js/89.b80b10c6.js"><link rel="prefetch" href="/assets/js/9.24d5e519.js"><link rel="prefetch" href="/assets/js/90.a059a06c.js"><link rel="prefetch" href="/assets/js/91.0c2e07a8.js"><link rel="prefetch" href="/assets/js/92.0460267f.js"><link rel="prefetch" href="/assets/js/93.630cc9b9.js"><link rel="prefetch" href="/assets/js/94.64e96711.js"><link rel="prefetch" href="/assets/js/95.cc7ee0e1.js"><link rel="prefetch" href="/assets/js/96.43f96f85.js"><link rel="prefetch" href="/assets/js/97.73dc1af0.js"><link rel="prefetch" href="/assets/js/98.10b4ffee.js"><link rel="prefetch" href="/assets/js/99.e6bfc1cd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b25eaea0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/flaglogo.png" alt="Wow56 个人知识库" class="logo"> <span class="site-name can-hide">Wow56 个人知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/base/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言/语法" class="dropdown-title"><span class="title">语言/语法</span> <span class="arrow down"></span></button> <button type="button" aria-label="语言/语法" class="mobile-dropdown-title"><span class="title">语言/语法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lang/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/lang/go/" class="nav-link">
  Go
</a></li><li class="dropdown-item"><!----> <a href="/lang/php/" class="nav-link">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/lang/js/" class="nav-link">
  Java Script
</a></li><li class="dropdown-item"><!----> <a href="/lang/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/lang/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/lang/regex/" class="nav-link">
  Regex
</a></li><li class="dropdown-item"><!----> <a href="/lang/script/" class="nav-link">
  脚本 Script
</a></li><li class="dropdown-item"><!----> <a href="/lang/markdown/" class="nav-link">
  Markdown
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架/类库" class="dropdown-title"><span class="title">框架/类库</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架/类库" class="mobile-dropdown-title"><span class="title">框架/类库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          应用程序
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/spring/" class="nav-link">
  Spring 生态
</a></li><li class="dropdown-subitem"><a href="/framework/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/gis/" class="nav-link">
  Web GIS
</a></li><li class="dropdown-subitem"><a href="/framework/echarts/" class="nav-link">
  ECahrts
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          关系型
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mysql/" class="nav-link router-link-active">
  MySQL
</a></li></ul></li><li class="dropdown-item"><h4>
          非关系型
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mongodb/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-subitem"><a href="/db/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/db/es/" class="nav-link">
  Elasticsearch
</a></li></ul></li><li class="dropdown-item"><h4>
          持久层框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mybatis/" class="nav-link">
  MyBatis
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="应用技术" class="dropdown-title"><span class="title">应用技术</span> <span class="arrow down"></span></button> <button type="button" aria-label="应用技术" class="mobile-dropdown-title"><span class="title">应用技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/applied-tech/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/svn/" class="nav-link">
  SVN
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/maven/" class="nav-link">
  Maven
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/mq/" class="nav-link">
  MQ
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/k8s/" class="nav-link">
  Kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/cas/" class="nav-link">
  CAS
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/workflow/" class="nav-link">
  Workflow
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机素养" class="dropdown-title"><span class="title">计算机素养</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机素养" class="mobile-dropdown-title"><span class="title">计算机素养</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computer-literacy/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/computer-literacy/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/computer-literacy/security/" class="nav-link">
  安全
</a></li><li class="dropdown-item"><!----> <a href="/computer-literacy/data-structure/" class="nav-link">
  数据结构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发常识" class="dropdown-title"><span class="title">开发常识</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发常识" class="mobile-dropdown-title"><span class="title">开发常识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/common-sense/common/common_sense.html" class="nav-link">
  常识
</a></li><li class="dropdown-item"><!----> <a href="/common-sense/ide-settings/" class="nav-link">
  IDE 开发环境配置
</a></li><li class="dropdown-item"><!----> <a href="/common-sense/log/" class="nav-link">
  Log
</a></li><li class="dropdown-item"><!----> <a href="/common-sense/test/" class="nav-link">
  Test
</a></li><li class="dropdown-item"><!----> <a href="/common-sense/swagger/" class="nav-link">
  Swagger
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分享" class="dropdown-title"><span class="title">分享</span> <span class="arrow down"></span></button> <button type="button" aria-label="分享" class="mobile-dropdown-title"><span class="title">分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/share/faq/" class="nav-link">
  FAQ
</a></li><li class="dropdown-item"><!----> <a href="/share/recommend/" class="nav-link">
  推荐
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="阅读" class="dropdown-title"><span class="title">阅读</span> <span class="arrow down"></span></button> <button type="button" aria-label="阅读" class="mobile-dropdown-title"><span class="title">阅读</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/read/effective_java.html" class="nav-link">
  Effective Java
</a></li><li class="dropdown-item"><!----> <a href="/read/clean_code.html" class="nav-link">
  代码整洁之道
</a></li><li class="dropdown-item"><!----> <a href="/read/coding_style.html" class="nav-link">
  Coding Style
</a></li><li class="dropdown-item"><!----> <a href="/read/gx.html" class="nav-link">
  高项笔记
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/wow56/wow56.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/base/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言/语法" class="dropdown-title"><span class="title">语言/语法</span> <span class="arrow down"></span></button> <button type="button" aria-label="语言/语法" class="mobile-dropdown-title"><span class="title">语言/语法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lang/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/lang/go/" class="nav-link">
  Go
</a></li><li class="dropdown-item"><!----> <a href="/lang/php/" class="nav-link">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/lang/js/" class="nav-link">
  Java Script
</a></li><li class="dropdown-item"><!----> <a href="/lang/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/lang/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/lang/regex/" class="nav-link">
  Regex
</a></li><li class="dropdown-item"><!----> <a href="/lang/script/" class="nav-link">
  脚本 Script
</a></li><li class="dropdown-item"><!----> <a href="/lang/markdown/" class="nav-link">
  Markdown
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架/类库" class="dropdown-title"><span class="title">框架/类库</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架/类库" class="mobile-dropdown-title"><span class="title">框架/类库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          应用程序
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/spring/" class="nav-link">
  Spring 生态
</a></li><li class="dropdown-subitem"><a href="/framework/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/gis/" class="nav-link">
  Web GIS
</a></li><li class="dropdown-subitem"><a href="/framework/echarts/" class="nav-link">
  ECahrts
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          关系型
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mysql/" class="nav-link router-link-active">
  MySQL
</a></li></ul></li><li class="dropdown-item"><h4>
          非关系型
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mongodb/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-subitem"><a href="/db/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/db/es/" class="nav-link">
  Elasticsearch
</a></li></ul></li><li class="dropdown-item"><h4>
          持久层框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mybatis/" class="nav-link">
  MyBatis
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="应用技术" class="dropdown-title"><span class="title">应用技术</span> <span class="arrow down"></span></button> <button type="button" aria-label="应用技术" class="mobile-dropdown-title"><span class="title">应用技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/applied-tech/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/svn/" class="nav-link">
  SVN
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/maven/" class="nav-link">
  Maven
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/mq/" class="nav-link">
  MQ
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/k8s/" class="nav-link">
  Kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/cas/" class="nav-link">
  CAS
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/workflow/" class="nav-link">
  Workflow
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机素养" class="dropdown-title"><span class="title">计算机素养</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机素养" class="mobile-dropdown-title"><span class="title">计算机素养</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computer-literacy/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/computer-literacy/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/computer-literacy/security/" class="nav-link">
  安全
</a></li><li class="dropdown-item"><!----> <a href="/computer-literacy/data-structure/" class="nav-link">
  数据结构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发常识" class="dropdown-title"><span class="title">开发常识</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发常识" class="mobile-dropdown-title"><span class="title">开发常识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/common-sense/common/common_sense.html" class="nav-link">
  常识
</a></li><li class="dropdown-item"><!----> <a href="/common-sense/ide-settings/" class="nav-link">
  IDE 开发环境配置
</a></li><li class="dropdown-item"><!----> <a href="/common-sense/log/" class="nav-link">
  Log
</a></li><li class="dropdown-item"><!----> <a href="/common-sense/test/" class="nav-link">
  Test
</a></li><li class="dropdown-item"><!----> <a href="/common-sense/swagger/" class="nav-link">
  Swagger
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分享" class="dropdown-title"><span class="title">分享</span> <span class="arrow down"></span></button> <button type="button" aria-label="分享" class="mobile-dropdown-title"><span class="title">分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/share/faq/" class="nav-link">
  FAQ
</a></li><li class="dropdown-item"><!----> <a href="/share/recommend/" class="nav-link">
  推荐
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="阅读" class="dropdown-title"><span class="title">阅读</span> <span class="arrow down"></span></button> <button type="button" aria-label="阅读" class="mobile-dropdown-title"><span class="title">阅读</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/read/effective_java.html" class="nav-link">
  Effective Java
</a></li><li class="dropdown-item"><!----> <a href="/read/clean_code.html" class="nav-link">
  代码整洁之道
</a></li><li class="dropdown-item"><!----> <a href="/read/coding_style.html" class="nav-link">
  Coding Style
</a></li><li class="dropdown-item"><!----> <a href="/read/gx.html" class="nav-link">
  高项笔记
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/wow56/wow56.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/db/mysql/" aria-current="page" class="sidebar-link">MySQL 总览</a></li><li><a href="/db/mysql/mysql.html" class="sidebar-link">MySQL</a></li><li><a href="/db/mysql/mysql_advanced.html" aria-current="page" class="active sidebar-link">MySQL 进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#参考文档" class="sidebar-link">参考文档</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#存储引擎" class="sidebar-link">存储引擎</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#innodb" class="sidebar-link">InnoDB</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#myisam" class="sidebar-link">MyISAM</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#memory" class="sidebar-link">Memory</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#常见引擎对比" class="sidebar-link">常见引擎对比</a></li></ul></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#索引" class="sidebar-link">索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#最左前缀原则" class="sidebar-link">最左前缀原则</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#索引失效场景" class="sidebar-link">索引失效场景</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#sql-提示" class="sidebar-link">SQL 提示</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#覆盖索引" class="sidebar-link">覆盖索引</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#前缀索引" class="sidebar-link">前缀索引</a></li></ul></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#性能分析" class="sidebar-link">性能分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#sql-执行频率" class="sidebar-link">SQL 执行频率</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#慢查询日志" class="sidebar-link">慢查询日志</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#profile" class="sidebar-link">profile</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#explain-执行计划" class="sidebar-link">explain 执行计划</a></li></ul></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#sql-优化" class="sidebar-link">SQL 优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#插入数据" class="sidebar-link">插入数据</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#主键优化" class="sidebar-link">主键优化</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#orderby-优化" class="sidebar-link">orderBy 优化</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#groupby-优化" class="sidebar-link">groupBy 优化</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#limit-优化" class="sidebar-link">limit 优化</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#count-优化" class="sidebar-link">count 优化</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#update-优化" class="sidebar-link">update 优化</a></li></ul></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#索引原理" class="sidebar-link">索引原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#聚簇索引" class="sidebar-link">聚簇索引</a></li></ul></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#存储对象" class="sidebar-link">存储对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#视图" class="sidebar-link">视图</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#存储过程" class="sidebar-link">存储过程</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#存储函数" class="sidebar-link">存储函数</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#触发器" class="sidebar-link">触发器</a></li></ul></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#锁" class="sidebar-link">锁</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#全局锁" class="sidebar-link">全局锁</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#表级锁" class="sidebar-link">表级锁</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#行级锁" class="sidebar-link">行级锁</a></li></ul></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#innodb-详解" class="sidebar-link">InnoDB 详解</a></li><li class="sidebar-sub-header"><a href="/db/mysql/mysql_advanced.html#讨论区" class="sidebar-link">讨论区</a></li></ul></li><li><a href="/db/mysql/mysql_install.html" class="sidebar-link">MySQL 安装配置</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql-进阶"><a href="#mysql-进阶" class="header-anchor">#</a> MySQL 进阶</h1> <h2 id="参考文档"><a href="#参考文档" class="header-anchor">#</a> 参考文档</h2> <p>// TODO</p> <h2 id="存储引擎"><a href="#存储引擎" class="header-anchor">#</a> 存储引擎</h2> <p>常见搜索引擎有 InnoDB(5.5 之后默认)、MyIsam、Memory...</p> <ul><li><p>建表时，指定存储引擎</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 表名 <span class="token punctuation">(</span>
    字段<span class="token number">1</span> 字段<span class="token number">1</span>类型 <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> 注释<span class="token punctuation">]</span>，
    字段<span class="token number">2</span> 字段<span class="token number">2</span>类型 <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> 注释<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> 表注释<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>查看当前数据库支持的所有搜索引擎 <code>SHOW ENGINES;</code></p></li></ul> <h3 id="innodb"><a href="#innodb" class="header-anchor">#</a> InnoDB</h3> <p>MySQL 5.5 之后的默认存储引擎。</p> <p>特点：</p> <ul><li>支持事务，DML 操作遵循 ACID 模型。</li> <li>行级锁，提高并发访问性能。</li> <li>支持外键 <code>FOREIGN KEY</code>。</li></ul> <p>文件：<code>xxx.ibd</code>：xxx 是表名，InnoDB 引擎的每张表都会对应这样一个表空间文件，存放该表的表结构（frm、sdi）、数据和索引。</p> <p><code>idb2sdi xxx.ibd</code></p> <h4 id="逻辑存储结构"><a href="#逻辑存储结构" class="header-anchor">#</a> 逻辑存储结构</h4> <ul><li>表空间 <code>TableSpace</code>(.idb 文件)</li> <li>段 <code>Segment</code></li> <li>区 <code>Extent</code></li> <li>页 <code>Page</code></li> <li>行 <code>Row</code></li></ul> <p><img src="/assets/img/innodb-storage-structure.eeef928b.png" alt="InnoDB 存储结构"></p> <h4 id="innodb主键索引树高度"><a href="#innodb主键索引树高度" class="header-anchor">#</a> InnoDB主键索引树高度</h4> <blockquote><p>可以先去看索引原理中的树结构图。</p></blockquote> <p>InnoDB 指针占用 6 字节，一页大小固定为 16k，如果主键使用 bigint 类型（8 字节），一行数据假设为 1k，一页最多就可以存储 16 条数据，则：</p> <ul><li><p>若高度为 2：</p> <p><code>n*8 + (n+1)*6 = 16*1024</code> (一页大小)，n 为 key 数，可得 <code>n = 1171</code>，那么一页最多存储 1171 Key（page），<code>1171*16（每一页数据量）=18736</code>，可知，高度为 2，最多存放 18736 条数据。</p></li> <li><p>若高度为 3：</p> <p><code>1171 * 1171 * 16 = 21939856</code>，大概可以存放 2000w 左右数据。</p></li></ul> <h3 id="myisam"><a href="#myisam" class="header-anchor">#</a> MyISAM</h3> <p>MySQL 老版的默认存储引擎。</p> <p>特点：</p> <ul><li>表锁。</li> <li>访问速度快。</li></ul> <p>文件：<code>.MYD</code>（data）、<code>.MYI</code>(index) 和 <code>.sdi</code>（表结构）。</p> <h3 id="memory"><a href="#memory" class="header-anchor">#</a> Memory</h3> <p>Memory 引擎的表数据是存储在内存中的，所以只用做临时表或缓存。</p> <p>特点：</p> <ul><li>hash 索引（default）。</li> <li>访问速度极快。</li></ul> <p>文件：<code>xxx.sdi</code>，存储表结构信息。</p> <h3 id="常见引擎对比"><a href="#常见引擎对比" class="header-anchor">#</a> 常见引擎对比</h3> <p><img src="/assets/img/engine-compare.314c56d4.png" alt="常见引擎对比"></p> <h2 id="索引"><a href="#索引" class="header-anchor">#</a> 索引</h2> <p>MySQL 的索引共有以下几类：</p> <ul><li>主键索引 <code>PRIMARY</code></li> <li>唯一索引 <code>UNIQUE</code></li> <li>普通索引</li> <li>全文索引 <code>FULLTEXT</code> <ul><li>全文索引搜索的是文本中的关键词，不是比较索引中的值。</li></ul></li></ul> <p>相关语法：</p> <ul><li>查看索引 <code>SHOW INDEX FROM table_name;</code></li> <li>创建索引 <code>CREATE [UNIQUE | FULLTEXT] INDEX index_name ON table_name (field1_name, ...);</code></li> <li>删除索引 <code>DROP INDEX index_name ON table_name;</code></li></ul> <h3 id="最左前缀原则"><a href="#最左前缀原则" class="header-anchor">#</a> 最左前缀原则</h3> <blockquote><p>最左前缀原则，或最左匹配原则，最左前缀匹配原则 指的是同一个东西。</p></blockquote> <p>数据库索引分为单键索引和复合索引，单键索引的命中无需多说。最左前缀原则是指在复合索引中的命中规则。</p> <p>假如有一个索引 <code>a_1_b_1_c_1</code>，当查询 a、a+b、a+b+c 都可以命中该索引，但是 b、b+c、c 就不能命中索引。</p> <p>另外，a+c 也会命中索引，它会从所有 a 相同的数据中查询等于 c 的数据。</p> <h4 id="范围查询"><a href="#范围查询" class="header-anchor">#</a> 范围查询</h4> <p>在复合索引中，如果出现范围查询（<code>&gt;</code>,<code>&lt;</code>），范围查询右侧列索引失效。这时候建议使用 <code>&gt;=</code> or <code>&lt;=</code>。</p> <h3 id="索引失效场景"><a href="#索引失效场景" class="header-anchor">#</a> 索引失效场景</h3> <ul><li>优化器认为全表扫描更快。</li> <li>字符串类型字段使用时，没有加 <code>''</code>，索引会失效。</li> <li>头部模糊匹配（尾部模糊不会失效），索引失效。</li> <li><code>or</code> 连接的两侧字段都要有对应索引，否则索引失效。</li> <li>在索引列进行运算时，索引会失效。</li></ul> <h3 id="sql-提示"><a href="#sql-提示" class="header-anchor">#</a> SQL 提示</h3> <ul><li>use index <code>explain select * from table_name use index(index_name) where x = y</code> // 建议</li> <li>ignore index <code>explain select * from table_name ignore index(index_name) where x = y</code></li> <li>force index <code>explain select * from table_name force index(index_name) where x = y</code></li></ul> <h3 id="覆盖索引"><a href="#覆盖索引" class="header-anchor">#</a> 覆盖索引</h3> <blockquote><p>回表，联合索引涉及到的字段并没有完全包含所要查询的字段，这时候就需要先在辅助索引（联合索引）中查找主数据的 id，然后拿 id 去聚簇索引中查找辅助索引中不存在的字段值。</p> <p>要想更好的了解回表，需要先了解 InnoDB 的<a href="#%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95">聚簇索引</a>和辅助索引的概念。</p></blockquote> <p>尽量使用覆盖索引，即查询返回的列在该索引中都可以找到，减少使用 <code>SELECT *</code>，本质是减少回表操作。</p> <h3 id="前缀索引"><a href="#前缀索引" class="header-anchor">#</a> 前缀索引</h3> <blockquote><p>当某个字段类型是字符串（<code>varchar</code>、<code>text</code> 等）时，如果这个字段中存放的字符串长度很大，被索引时，索引也就变的很大，查询时，就会浪费大量的磁盘 IO，进而影响查询效率。这时，可以取字符串的一部分前缀作为索引，这样就可以很大程度的解约索引空间，从而提高索引效率。</p></blockquote> <p>语法：<code>CREATE INDEX index_name ON table_name(field_name(n))</code> // n 代表截取值的前 n 位</p> <p>在评估 n 的取值时，可以根据索引的选择性来判断。</p> <p>选择性：一列中数据去重后/这一列总数 = 选择性。例如：</p> <ul><li><code>select count(distinct email) / count(*) from user;</code></li> <li><code>select count(distinct substring(email,1,5)) / count(*) from user;</code> // 取 email 的前 5 位后的选择性值</li></ul> <h2 id="性能分析"><a href="#性能分析" class="header-anchor">#</a> 性能分析</h2> <h3 id="sql-执行频率"><a href="#sql-执行频率" class="header-anchor">#</a> SQL 执行频率</h3> <p>通过执行频率可以判断某个数据库重点是以增删改查中哪类操作为主，来判断是否需要进行优化。</p> <p>语法：<code>SHOW GLOBAL/SESSION STATUS LIKE 'Com_______'</code> // 7 个下划线</p> <p><img src="/assets/img/sql-execution-frequency.340fbaf6.png" alt="sql execution frequency"></p> <h3 id="慢查询日志"><a href="#慢查询日志" class="header-anchor">#</a> 慢查询日志</h3> <ul><li>查看慢查询日志配置 <code>show variables likes 'slow_query_log';</code></li></ul> <p>MySQL 慢查询日志默认关闭，需要在配置文件（<code>/etc/my.cnf</code>）中配置：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 开启</span>
<span class="token assign-left variable">slow_query_log</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment"># 配置慢查询日志阈值，这里是超过 2s 会被记录，默认为 10s</span>
<span class="token assign-left variable">long_query_time</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>日志默认存放位置 <code>/var/lib/mysql/localhost-slow.log</code></p> <h3 id="profile"><a href="#profile" class="header-anchor">#</a> profile</h3> <blockquote><p>使用前通过 <code>have_profiling</code> 参数查看当前数据库是否支持 profile，<code>SELECT @@have_profiling</code>。</p></blockquote> <ul><li>通过 <code>SELECT @@profiling</code> 查看是否开启。</li> <li>MySQL 的 profile 默认是关闭的，可以通过 <code>SET profiling = 1;</code> 来开启 profiling。</li></ul> <p>查看详情：</p> <ul><li>通过 <code>show profiles</code> 可以在优化 SQL 时，看到时间具体的耗费详情。</li> <li>查看某一条 query 的具体时间消耗详情 <code>show profile for query query_id;</code>。</li> <li>查看某一条 query 的 SQL 语句的 CPU 使用情况 <code>show profile cpu for query query_id;</code>。</li></ul> <h3 id="explain-执行计划"><a href="#explain-执行计划" class="header-anchor">#</a> explain 执行计划</h3> <p>直接在查询语句前面加上 <code>EXPLAIN</code> 或 <code>DESC</code> 就可以查看该 query 对应的执行计划分析了，例如：</p> <p><code>explain SELECT * from user;</code></p> <p><img src="/assets/img/explain.74b542c9.png" alt="explain 示例"></p> <h4 id="explain-各字段含义"><a href="#explain-各字段含义" class="header-anchor">#</a> explain 各字段含义</h4> <details class="custom-block details"><summary>点开查看</summary> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># explain 执行计划各字段含义</span>

<span class="token comment"># id</span>
<span class="token comment">#</span>
<span class="token comment"># select 查询的序列号，表示查询中执行 select 子句或者是操作表的顺序（id 相同，执行顺序从上到下；id 不同，值越大，越先执行），如果是多个表查询，结果就会有多行，这时候可以通过这一行判断多张表的执行顺序。</span>

<span class="token comment"># select_type</span>
<span class="token comment"># </span>
<span class="token comment"># 表示 SELECT 的类型，常见取值有 SIMPLE（简单表，即不使用表连接或子查询）、PRIMARY（主查询，即外层查询）、UNION（UNION 中的第二个或者后面的查询语句）、SUBQUERY（SELECT/WHERE 之后包含了子查询）等。</span>

<span class="token comment"># type</span>
<span class="token comment"># </span>
<span class="token comment"># 表示连接类型，性能由好到坏依次为：NULL、system、const、eq_ref、ref、range、index、all。</span>

<span class="token comment"># possible_key</span>
<span class="token comment"># </span>
<span class="token comment"># 显示这张表上可能用到的 索引，一个或多个。</span>

<span class="token comment"># key</span>
<span class="token comment"># </span>
<span class="token comment"># 实际使用的索引，如果为 NULL，表示没有用到索引</span>

<span class="token comment"># key_len</span>
<span class="token comment"># </span>
<span class="token comment"># 表示索引中使用的字节数，该值为索引字段最大可能长度，并非实际使用长度，在不损失精确性的情况下，长度越短越好。</span>

<span class="token comment"># rows</span>
<span class="token comment"># </span>
<span class="token comment"># MySQL 认为必须要执行查询的行数，在 innoDB 表中，这是个估计值，并不太准确。</span>

<span class="token comment"># filtered</span>
<span class="token comment"># </span>
<span class="token comment"># 表示返回结果的行数占需读取行数的百分比，值越大越好。</span>

<span class="token comment"># Extra </span>
<span class="token comment"># </span>
<span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div></details> <h2 id="sql-优化"><a href="#sql-优化" class="header-anchor">#</a> SQL 优化</h2> <h3 id="插入数据"><a href="#插入数据" class="header-anchor">#</a> 插入数据</h3> <ul><li><p>多条 insert 可以改成 insert 批量插入。</p></li> <li><p>手动提交事务，可以所有数据插入完成再提交事务（默认每条 SQL 自动提交事务）。</p></li> <li><p>主键按照顺序插入。</p></li> <li><p>大批量的插入数据可以使用 load 加载 CSV 文件的数据。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 连接客户端时，使用 --local-infile 参数</span>
mysql --local-infile -u root -p
<span class="token comment"># 开启从本地加载文件导入数据的开关，设置全局参数 local_infile = 1;</span>
<span class="token builtin class-name">set</span> global local_infile <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment"># load 命令加载文件数据</span>
<span class="token comment"># fields terminated by ',' 指定字段的分隔符</span>
<span class="token comment"># lines terminaterd by '\n' 指定行分隔符</span>
load data <span class="token builtin class-name">local</span> infile <span class="token string">'/home/sql1.log'</span> into table table_name fields terminated by <span class="token string">','</span> lines terminaterd by <span class="token string">'\n'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul> <h3 id="主键优化"><a href="#主键优化" class="header-anchor">#</a> 主键优化</h3> <ul><li>主键需要顺序插入
<ul><li>如果乱序可能会发生页分裂</li></ul></li> <li>尽量降低主键长度，因为主键数据也是会占用空间的。</li></ul> <p>页分裂、页合并现象。判断阈值默认为 50%</p> <h3 id="orderby-优化"><a href="#orderby-优化" class="header-anchor">#</a> orderBy 优化</h3> <ul><li><code>using filesort</code>，通过表的索引或全表扫描，读取满足条件的数据行，然后在排序缓冲区 sort buffer 中完成操作，所有不是通过索引直接返回排序结果的都是 filesort 排序。</li> <li><code>using index</code>，通过有序索引顺序扫描直接返回有序数据，不需要额外排序，操作效率高。</li></ul> <p>大数量排序可以适当增大排序缓冲区大小：<code>sort_buffer_size</code>（默认 256kb）</p> <h3 id="groupby-优化"><a href="#groupby-优化" class="header-anchor">#</a> groupBy 优化</h3> <p>索引对于 group by 的影响。尽量使用索引覆盖要操作的字段。</p> <h3 id="limit-优化"><a href="#limit-优化" class="header-anchor">#</a> limit 优化</h3> <p><code>select * from user limit 50000,10</code> 大分页问题。</p> <p>主键索引+子查询方式优化 <code>select u.* from user u, (select id from user limit 50000,10) t where u.id = t.id;</code>，将子查询看做临时表，然后联查。</p> <h3 id="count-优化"><a href="#count-优化" class="header-anchor">#</a> count 优化</h3> <p><code>select count(*) from user</code></p> <ul><li><code>count(主键)</code>，InnoDB 遍历整张表，把每行的 id 取出来，然后累加。</li> <li><code>count(字段)</code>，先判断该字段是否有 not null 约束，来判断直接累加还是去判断每行是否为 null 再累加。这里只会统计不为 NULL 的数据个数。</li> <li><code>count(1)</code>，遍历整张表，不取值，每遍历一行数据，返回一个 1，最后将累加。注意这里是加返回数字的个数，并不是累加返回的数字1，这里 0 和 1 的结果一样的。</li> <li><code>count(*)</code>，InnoDB 不取值，直接按行累加。</li></ul> <p>效率由高到低：<code>count(*)</code> ≈ <code>count(1)</code> &gt; <code>count(主键)</code> &gt; <code>count(字段)</code></p> <h3 id="update-优化"><a href="#update-优化" class="header-anchor">#</a> update 优化</h3> <p>update 更新数据时，要根据 索引字段 作为条件，这样的话，InnoDB 会加 行锁。但是如果不加索引，行锁会升级为表锁，这时其他的 update 操作会阻塞。</p> <ul><li><code>update user set name = &quot;xiaoming&quot; where id = 1</code> // 这里只会锁住 id = 1 这行数据</li> <li><code>update user set name = &quot;xiaoming&quot; where age = 18</code> // 如果 age 没有索引，是表锁，age 有索引，只会是行锁</li></ul> <h2 id="索引原理"><a href="#索引原理" class="header-anchor">#</a> 索引原理</h2> <p>索引就是帮助快速搜索数据的一种数据结构，每种搜索引擎的实现都不太一样，主要常见的索引有以下几种：</p> <ul><li><code>B+Tree 索引</code>，最常用的索引实现方式，大部分引擎都支持。</li> <li><code>Hash 索引</code>，通过哈希表实现，只有精确匹配索引列的时候有效，不支持范围查询。</li> <li><code>Full-text 全文索引</code>，是一种通过建立倒排索引，快速匹配文档的方式。例如 <code>Lucene</code>、<code>Solr</code>、<code>Elasticsearch</code>(基于 Lucene)</li> <li>...</li></ul> <table><thead><tr><th>索引类型</th> <th>InnoDB</th> <th>MyISAM</th> <th>Memory</th></tr></thead> <tbody><tr><td>B+Tree</td> <td>Y</td> <td>Y</td> <td>Y</td></tr> <tr><td>Hash</td> <td>-</td> <td>-</td> <td>Y</td></tr> <tr><td>Full-text</td> <td>5.6 以后支持</td> <td>Y</td> <td>-</td></tr></tbody></table> <blockquote><p>MySQL 的索引使用 <a href="/computer-literacy/data-structure/data_structure.html#btree">B+Tree</a> 原理，在 B+Tree 基础上改进了一些。</p></blockquote> <p><img src="/assets/img/mysql-b+tree.2a2ec73e.png" alt="MySQL 索引原理"></p> <h3 id="聚簇索引"><a href="#聚簇索引" class="header-anchor">#</a> 聚簇索引</h3> <p>InnoDB 的索引分为两类，聚簇索引和辅助索引（二级索引）。</p> <p>从 B+Tree 的原理中可以看出 InnoDB 中索引是和数据在一起的，但实际上并不是所有的索引都和数据存放在一起（硬盘中）。InnoDB 的表数据中只有主键索引，其他索引单独存在（不包含数据）。当一张表被创建时，InnoDB 会选择设置的主键那一列作为主键索引来组织数据，如果没有设置主键索引，那么它会选择一列它认为值唯一的一列作为主键索引来组织数据，如果没有这样的一列数据，那它会自己生成一列唯一数据隐藏起来追加在表的最后一列作为主键来组织数据。</p> <p>除了主键索引外的所有索引都是辅助索引，也叫二级索引。辅助索引的 B+Tree 的叶子结点中存放的是数据的主键值，聚簇索引中的叶子结点存放的是原数据（row）。</p> <p>聚簇索引是 InnoDB 中的概念，在 MyIsam 中，数据（在硬盘中）和索引是分别存放的，MyIsam 的索引叶子结点存放的都是主键值。</p> <h2 id="存储对象"><a href="#存储对象" class="header-anchor">#</a> 存储对象</h2> <h3 id="视图"><a href="#视图" class="header-anchor">#</a> 视图</h3> <h4 id="创建视图"><a href="#创建视图" class="header-anchor">#</a> 创建视图</h4> <p>语法：<code>CREATE [OR REPLACE] VIEW 视图名称 AS SELECT 语句 [WITH [CASCADED | LOCAL] CHECK OPTION]</code></p> <p>例如 <code>create or replace view user_view as select id, name from user where age &gt; 10;</code></p> <p><strong>检查选项</strong></p> <p>在对视图进行增删改查的时候，实际操作的是 基表。</p> <p>假如一个视图是这么创建的 <code>create view user_view as select id, name from user where age &gt; 10;</code>，在对视图的数据进行操作的时候，如果你执行了 <code>insert into user_view values(5, &quot;Daming&quot;, 12)</code>，插入一个 12 岁的数据，显然不符合视图的限制。但是这里却能插入成功，只是在视图中不显示。如果想要限制插入不符合视图的数据，可以这样创建视图 <code>create view user_view as select id, name from user where age &gt; 10 with check option;</code>，这时候再插入 12 岁的数据就会直接报错。</p> <p>这里的参数 <code>with check option</code> 等同于 <code>with cascaded check option</code>，cascaded 是默认值。另外还有一个值 local，即 <code>with local check option</code>。</p> <p>因为视图是可以基于另一个视图去创建的，当视图 2 的条件和视图 1 的条件不一样的时候，使用 <code>with cascaded check option</code> 可以在插入数据的时候，检查视图 2 的同时也会去检查是否满足视图 1。如果视图 3 又基于视图 2 创建，但是没有添加 <code>with check option</code> 参数，那么插入的时候，不会检查当前视图 3 的条件，但是会向上检查。</p> <h4 id="查询视图"><a href="#查询视图" class="header-anchor">#</a> 查询视图</h4> <p>查看创建视图语句：<code>SHOW CREATE VIEW 视图名称</code>，查询数据的话，和查询表数据是一样的。</p> <h4 id="修改视图"><a href="#修改视图" class="header-anchor">#</a> 修改视图</h4> <p>两种方式：</p> <ul><li><code>CREATE OR REPLACE VIEW 视图名称 AS SELECT 语句</code>  // 利用了 OR REPLACE 参数</li> <li><code>ALTER VIEW 视图名称 AS SELECT 语句</code></li></ul> <h4 id="删除视图"><a href="#删除视图" class="header-anchor">#</a> 删除视图</h4> <p><code>DROP VIEW [IF EXISTS] 视图名称</code></p> <h3 id="存储过程"><a href="#存储过程" class="header-anchor">#</a> 存储过程</h3> <p>// TODO</p> <h3 id="存储函数"><a href="#存储函数" class="header-anchor">#</a> 存储函数</h3> <p>// TODO</p> <h3 id="触发器"><a href="#触发器" class="header-anchor">#</a> 触发器</h3> <p>// TODO</p> <h2 id="锁"><a href="#锁" class="header-anchor">#</a> 锁</h2> <h3 id="全局锁"><a href="#全局锁" class="header-anchor">#</a> 全局锁</h3> <blockquote><p>锁定数据库中的所有表</p></blockquote> <p>使用场景：全库数据备份中使用全局锁，对所有表锁定，为了获取一致性视图，保证数据的完整性。</p> <p><code>flush tables with read lock;</code> 加锁 -&gt; <code>mysqldump -uroot -p12345 user &gt; user.sql</code> 导出数据 -&gt; <code>unlock tables;</code> 释放锁</p> <p>可以使用 <code>--single-transaction</code> 参数实现不加锁的一致性数据备份：<code>mysqldump --single-transaction -uroot -p12345 user &gt; user.sql</code></p> <h3 id="表级锁"><a href="#表级锁" class="header-anchor">#</a> 表级锁</h3> <blockquote><p>锁住整张表</p></blockquote> <p>表级锁主要分为 3 类：表锁、元数据锁（meta data lock）和意向锁。</p> <h4 id="表锁"><a href="#表锁" class="header-anchor">#</a> 表锁</h4> <p>表锁分为：</p> <ul><li>表共享读锁（read lock），加锁后，当前客户端和其他客户端都只能读，不能写。</li> <li>表独占写锁（write lock），加锁后，当前客户端可读可写，其他客户端不可读写。</li></ul> <p>语法：</p> <ul><li>加锁，<code>lock tables 表名... read/write</code></li> <li>释放锁，<code>unlock tables / 客户端断开链接</code></li></ul> <h4 id="元数据锁"><a href="#元数据锁" class="header-anchor">#</a> 元数据锁</h4> <blockquote><p>元数据锁，meta data lock，即 MDL。MYSQL 5.5 引入。</p></blockquote> <p>MDL 加锁过程是系统自动控制，无需显示使用，在访问一张表的时候会自动加上。MDL 锁主要作用是维护表元数据的数据一致性，在表上有活动事务的时候，不可以对元数据进行写入操作。</p> <p>当对一张表进行增删改查的时候，加 MDL 读锁（共享）；当对表结构进行变更操作的时候，加 MDL 写锁（排他）。</p> <h3 id="行级锁"><a href="#行级锁" class="header-anchor">#</a> 行级锁</h3> <blockquote><p>锁住单行数据</p></blockquote> <h2 id="innodb-详解"><a href="#innodb-详解" class="header-anchor">#</a> InnoDB 详解</h2> <h2 id="讨论区"><a href="#讨论区" class="header-anchor">#</a> 讨论区</h2> <blockquote><p>由于评论过多会影响页面最下方的导航，故将评论区做默认折叠处理。</p></blockquote> <details class="custom-block details"><summary>点击查看评论区内容，渴望您的宝贵建议~</summary> <!----></details></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/22/2023, 2:04:47 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/db/mysql/mysql.html" class="prev">
        MySQL
      </a></span> <span class="next"><a href="/db/mysql/mysql_install.html">
        MySQL 安装配置
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5780eb53.js" defer></script><script src="/assets/js/2.e1f1d232.js" defer></script><script src="/assets/js/7.de70efc4.js" defer></script>
  </body>
</html>
