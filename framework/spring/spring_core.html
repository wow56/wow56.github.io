<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Core | Wow56 个人知识库</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/flaglogo.png">
    <link rel="manifest" href="/flaglogo.png">
    <link rel="apple-touch-icon" href="/flaglogo.png">
    <meta name="description" content="Never stop learning">
    
    <link rel="preload" href="/assets/css/0.styles.b25eaea0.css" as="style"><link rel="preload" href="/assets/js/app.5780eb53.js" as="script"><link rel="preload" href="/assets/js/2.e1f1d232.js" as="script"><link rel="preload" href="/assets/js/11.00deed7e.js" as="script"><link rel="prefetch" href="/assets/js/10.921c058c.js"><link rel="prefetch" href="/assets/js/100.678efb16.js"><link rel="prefetch" href="/assets/js/101.6fd33b9c.js"><link rel="prefetch" href="/assets/js/102.dfa6e733.js"><link rel="prefetch" href="/assets/js/103.4b74461a.js"><link rel="prefetch" href="/assets/js/104.603354fe.js"><link rel="prefetch" href="/assets/js/105.9da719c4.js"><link rel="prefetch" href="/assets/js/106.6aa24318.js"><link rel="prefetch" href="/assets/js/107.5ea57319.js"><link rel="prefetch" href="/assets/js/108.37ded6f2.js"><link rel="prefetch" href="/assets/js/109.adc40804.js"><link rel="prefetch" href="/assets/js/110.f1791c33.js"><link rel="prefetch" href="/assets/js/111.bff2cea6.js"><link rel="prefetch" href="/assets/js/112.4eb7e8b1.js"><link rel="prefetch" href="/assets/js/113.4ca0e39f.js"><link rel="prefetch" href="/assets/js/114.03d070d7.js"><link rel="prefetch" href="/assets/js/115.a007d470.js"><link rel="prefetch" href="/assets/js/116.027c798b.js"><link rel="prefetch" href="/assets/js/117.6eaa95a7.js"><link rel="prefetch" href="/assets/js/118.3468f2af.js"><link rel="prefetch" href="/assets/js/119.94c060f2.js"><link rel="prefetch" href="/assets/js/12.e7e7feff.js"><link rel="prefetch" href="/assets/js/120.2639e06f.js"><link rel="prefetch" href="/assets/js/121.1ee7e578.js"><link rel="prefetch" href="/assets/js/122.d1f0654b.js"><link rel="prefetch" href="/assets/js/123.52d57be3.js"><link rel="prefetch" href="/assets/js/124.d515f509.js"><link rel="prefetch" href="/assets/js/125.c783db82.js"><link rel="prefetch" href="/assets/js/126.08d41fac.js"><link rel="prefetch" href="/assets/js/127.5ab5b3c5.js"><link rel="prefetch" href="/assets/js/13.c0e1c39d.js"><link rel="prefetch" href="/assets/js/14.4be8face.js"><link rel="prefetch" href="/assets/js/15.b235fe5f.js"><link rel="prefetch" href="/assets/js/16.a62bd2ec.js"><link rel="prefetch" href="/assets/js/17.d3fa5b5a.js"><link rel="prefetch" href="/assets/js/18.04056df6.js"><link rel="prefetch" href="/assets/js/19.e0daa831.js"><link rel="prefetch" href="/assets/js/20.aae5efb2.js"><link rel="prefetch" href="/assets/js/21.51bfd139.js"><link rel="prefetch" href="/assets/js/22.d92aecaf.js"><link rel="prefetch" href="/assets/js/23.fd2079a6.js"><link rel="prefetch" href="/assets/js/24.7cadaa30.js"><link rel="prefetch" href="/assets/js/25.38c9c1a4.js"><link rel="prefetch" href="/assets/js/26.1c8277a8.js"><link rel="prefetch" href="/assets/js/27.1e495f81.js"><link rel="prefetch" href="/assets/js/28.7ef5af76.js"><link rel="prefetch" href="/assets/js/29.9031cb92.js"><link rel="prefetch" href="/assets/js/3.93a08b3b.js"><link rel="prefetch" href="/assets/js/30.1b61bbf8.js"><link rel="prefetch" href="/assets/js/31.f8cbfd44.js"><link rel="prefetch" href="/assets/js/32.0632cb94.js"><link rel="prefetch" href="/assets/js/33.a46a0b3d.js"><link rel="prefetch" href="/assets/js/34.fba531e6.js"><link rel="prefetch" href="/assets/js/35.db1fd348.js"><link rel="prefetch" href="/assets/js/36.9e6108c6.js"><link rel="prefetch" href="/assets/js/37.35fca0f6.js"><link rel="prefetch" href="/assets/js/38.ac22df93.js"><link rel="prefetch" href="/assets/js/39.7cce2902.js"><link rel="prefetch" href="/assets/js/4.e30be376.js"><link rel="prefetch" href="/assets/js/40.3560e650.js"><link rel="prefetch" href="/assets/js/41.d4632345.js"><link rel="prefetch" href="/assets/js/42.adce46c5.js"><link rel="prefetch" href="/assets/js/43.d2ff2a7e.js"><link rel="prefetch" href="/assets/js/44.d3f6ac6e.js"><link rel="prefetch" href="/assets/js/45.1e3b049e.js"><link rel="prefetch" href="/assets/js/46.917a9a8a.js"><link rel="prefetch" href="/assets/js/47.5a73f25d.js"><link rel="prefetch" href="/assets/js/48.3b970b0a.js"><link rel="prefetch" href="/assets/js/49.dc6fd937.js"><link rel="prefetch" href="/assets/js/5.9411f932.js"><link rel="prefetch" href="/assets/js/50.109fdeb5.js"><link rel="prefetch" href="/assets/js/51.5ec4fc4b.js"><link rel="prefetch" href="/assets/js/52.0c03ff96.js"><link rel="prefetch" href="/assets/js/53.e91a6f48.js"><link rel="prefetch" href="/assets/js/54.7f886adb.js"><link rel="prefetch" href="/assets/js/55.2747b24f.js"><link rel="prefetch" href="/assets/js/56.a78db785.js"><link rel="prefetch" href="/assets/js/57.517d420c.js"><link rel="prefetch" href="/assets/js/58.0429f17c.js"><link rel="prefetch" href="/assets/js/59.9d68455f.js"><link rel="prefetch" href="/assets/js/6.3e126bb5.js"><link rel="prefetch" href="/assets/js/60.7cc000dc.js"><link rel="prefetch" href="/assets/js/61.8eaec827.js"><link rel="prefetch" href="/assets/js/62.9eb7a7b3.js"><link rel="prefetch" href="/assets/js/63.35e36177.js"><link rel="prefetch" href="/assets/js/64.6282d042.js"><link rel="prefetch" href="/assets/js/65.58ed4699.js"><link rel="prefetch" href="/assets/js/66.971cb02f.js"><link rel="prefetch" href="/assets/js/67.0a93b287.js"><link rel="prefetch" href="/assets/js/68.a7b05e3b.js"><link rel="prefetch" href="/assets/js/69.6572830f.js"><link rel="prefetch" href="/assets/js/7.de70efc4.js"><link rel="prefetch" href="/assets/js/70.168da9d9.js"><link rel="prefetch" href="/assets/js/71.d57d693b.js"><link rel="prefetch" href="/assets/js/72.91fa5cd3.js"><link rel="prefetch" href="/assets/js/73.7de2d2b8.js"><link rel="prefetch" href="/assets/js/74.acd298e4.js"><link rel="prefetch" href="/assets/js/75.62e67874.js"><link rel="prefetch" href="/assets/js/76.f2b96539.js"><link rel="prefetch" href="/assets/js/77.4255efc8.js"><link rel="prefetch" href="/assets/js/78.114300ba.js"><link rel="prefetch" href="/assets/js/79.d14a2756.js"><link rel="prefetch" href="/assets/js/8.1ec756ec.js"><link rel="prefetch" href="/assets/js/80.3fd73e00.js"><link rel="prefetch" href="/assets/js/81.71ebdbf4.js"><link rel="prefetch" href="/assets/js/82.0a5b5bb1.js"><link rel="prefetch" href="/assets/js/83.a23907a9.js"><link rel="prefetch" href="/assets/js/84.8c2bc996.js"><link rel="prefetch" href="/assets/js/85.ed1b9552.js"><link rel="prefetch" href="/assets/js/86.49d44a86.js"><link rel="prefetch" href="/assets/js/87.33153d90.js"><link rel="prefetch" href="/assets/js/88.a021dc21.js"><link rel="prefetch" href="/assets/js/89.b80b10c6.js"><link rel="prefetch" href="/assets/js/9.24d5e519.js"><link rel="prefetch" href="/assets/js/90.a059a06c.js"><link rel="prefetch" href="/assets/js/91.0c2e07a8.js"><link rel="prefetch" href="/assets/js/92.0460267f.js"><link rel="prefetch" href="/assets/js/93.630cc9b9.js"><link rel="prefetch" href="/assets/js/94.64e96711.js"><link rel="prefetch" href="/assets/js/95.cc7ee0e1.js"><link rel="prefetch" href="/assets/js/96.43f96f85.js"><link rel="prefetch" href="/assets/js/97.73dc1af0.js"><link rel="prefetch" href="/assets/js/98.10b4ffee.js"><link rel="prefetch" href="/assets/js/99.e6bfc1cd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b25eaea0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/flaglogo.png" alt="Wow56 个人知识库" class="logo"> <span class="site-name can-hide">Wow56 个人知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/base/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言/语法" class="dropdown-title"><span class="title">语言/语法</span> <span class="arrow down"></span></button> <button type="button" aria-label="语言/语法" class="mobile-dropdown-title"><span class="title">语言/语法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lang/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/lang/go/" class="nav-link">
  Go
</a></li><li class="dropdown-item"><!----> <a href="/lang/php/" class="nav-link">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/lang/js/" class="nav-link">
  Java Script
</a></li><li class="dropdown-item"><!----> <a href="/lang/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/lang/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/lang/regex/" class="nav-link">
  Regex
</a></li><li class="dropdown-item"><!----> <a href="/lang/script/" class="nav-link">
  脚本 Script
</a></li><li class="dropdown-item"><!----> <a href="/lang/markdown/" class="nav-link">
  Markdown
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架/类库" class="dropdown-title"><span class="title">框架/类库</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架/类库" class="mobile-dropdown-title"><span class="title">框架/类库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          应用程序
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/spring/" class="nav-link router-link-active">
  Spring 生态
</a></li><li class="dropdown-subitem"><a href="/framework/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/gis/" class="nav-link">
  Web GIS
</a></li><li class="dropdown-subitem"><a href="/framework/echarts/" class="nav-link">
  ECahrts
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          关系型
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mysql/" class="nav-link">
  MySQL
</a></li></ul></li><li class="dropdown-item"><h4>
          非关系型
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mongodb/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-subitem"><a href="/db/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/db/es/" class="nav-link">
  Elasticsearch
</a></li></ul></li><li class="dropdown-item"><h4>
          持久层框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mybatis/" class="nav-link">
  MyBatis
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="应用技术" class="dropdown-title"><span class="title">应用技术</span> <span class="arrow down"></span></button> <button type="button" aria-label="应用技术" class="mobile-dropdown-title"><span class="title">应用技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/applied-tech/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/svn/" class="nav-link">
  SVN
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/maven/" class="nav-link">
  Maven
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/mq/" class="nav-link">
  MQ
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/k8s/" class="nav-link">
  Kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/cas/" class="nav-link">
  CAS
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/workflow/" class="nav-link">
  Workflow
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机素养" class="dropdown-title"><span class="title">计算机素养</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机素养" class="mobile-dropdown-title"><span class="title">计算机素养</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computer-literacy/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/computer-literacy/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/computer-literacy/security/" class="nav-link">
  安全
</a></li><li class="dropdown-item"><!----> <a href="/computer-literacy/data-structure/" class="nav-link">
  数据结构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发常识" class="dropdown-title"><span class="title">开发常识</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发常识" class="mobile-dropdown-title"><span class="title">开发常识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/common-sense/common/common_sense.html" class="nav-link">
  常识
</a></li><li class="dropdown-item"><!----> <a href="/common-sense/ide-settings/" class="nav-link">
  IDE 开发环境配置
</a></li><li class="dropdown-item"><!----> <a href="/common-sense/log/" class="nav-link">
  Log
</a></li><li class="dropdown-item"><!----> <a href="/common-sense/test/" class="nav-link">
  Test
</a></li><li class="dropdown-item"><!----> <a href="/common-sense/swagger/" class="nav-link">
  Swagger
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分享" class="dropdown-title"><span class="title">分享</span> <span class="arrow down"></span></button> <button type="button" aria-label="分享" class="mobile-dropdown-title"><span class="title">分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/share/faq/" class="nav-link">
  FAQ
</a></li><li class="dropdown-item"><!----> <a href="/share/recommend/" class="nav-link">
  推荐
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="阅读" class="dropdown-title"><span class="title">阅读</span> <span class="arrow down"></span></button> <button type="button" aria-label="阅读" class="mobile-dropdown-title"><span class="title">阅读</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/read/effective_java.html" class="nav-link">
  Effective Java
</a></li><li class="dropdown-item"><!----> <a href="/read/clean_code.html" class="nav-link">
  代码整洁之道
</a></li><li class="dropdown-item"><!----> <a href="/read/coding_style.html" class="nav-link">
  Coding Style
</a></li><li class="dropdown-item"><!----> <a href="/read/gx.html" class="nav-link">
  高项笔记
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/wow56/wow56.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/base/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言/语法" class="dropdown-title"><span class="title">语言/语法</span> <span class="arrow down"></span></button> <button type="button" aria-label="语言/语法" class="mobile-dropdown-title"><span class="title">语言/语法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lang/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/lang/go/" class="nav-link">
  Go
</a></li><li class="dropdown-item"><!----> <a href="/lang/php/" class="nav-link">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/lang/js/" class="nav-link">
  Java Script
</a></li><li class="dropdown-item"><!----> <a href="/lang/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/lang/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/lang/regex/" class="nav-link">
  Regex
</a></li><li class="dropdown-item"><!----> <a href="/lang/script/" class="nav-link">
  脚本 Script
</a></li><li class="dropdown-item"><!----> <a href="/lang/markdown/" class="nav-link">
  Markdown
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架/类库" class="dropdown-title"><span class="title">框架/类库</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架/类库" class="mobile-dropdown-title"><span class="title">框架/类库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          应用程序
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/spring/" class="nav-link router-link-active">
  Spring 生态
</a></li><li class="dropdown-subitem"><a href="/framework/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/gis/" class="nav-link">
  Web GIS
</a></li><li class="dropdown-subitem"><a href="/framework/echarts/" class="nav-link">
  ECahrts
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          关系型
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mysql/" class="nav-link">
  MySQL
</a></li></ul></li><li class="dropdown-item"><h4>
          非关系型
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mongodb/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-subitem"><a href="/db/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/db/es/" class="nav-link">
  Elasticsearch
</a></li></ul></li><li class="dropdown-item"><h4>
          持久层框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mybatis/" class="nav-link">
  MyBatis
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="应用技术" class="dropdown-title"><span class="title">应用技术</span> <span class="arrow down"></span></button> <button type="button" aria-label="应用技术" class="mobile-dropdown-title"><span class="title">应用技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/applied-tech/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/svn/" class="nav-link">
  SVN
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/maven/" class="nav-link">
  Maven
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/mq/" class="nav-link">
  MQ
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/k8s/" class="nav-link">
  Kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/cas/" class="nav-link">
  CAS
</a></li><li class="dropdown-item"><!----> <a href="/applied-tech/workflow/" class="nav-link">
  Workflow
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机素养" class="dropdown-title"><span class="title">计算机素养</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机素养" class="mobile-dropdown-title"><span class="title">计算机素养</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computer-literacy/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/computer-literacy/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/computer-literacy/security/" class="nav-link">
  安全
</a></li><li class="dropdown-item"><!----> <a href="/computer-literacy/data-structure/" class="nav-link">
  数据结构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发常识" class="dropdown-title"><span class="title">开发常识</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发常识" class="mobile-dropdown-title"><span class="title">开发常识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/common-sense/common/common_sense.html" class="nav-link">
  常识
</a></li><li class="dropdown-item"><!----> <a href="/common-sense/ide-settings/" class="nav-link">
  IDE 开发环境配置
</a></li><li class="dropdown-item"><!----> <a href="/common-sense/log/" class="nav-link">
  Log
</a></li><li class="dropdown-item"><!----> <a href="/common-sense/test/" class="nav-link">
  Test
</a></li><li class="dropdown-item"><!----> <a href="/common-sense/swagger/" class="nav-link">
  Swagger
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分享" class="dropdown-title"><span class="title">分享</span> <span class="arrow down"></span></button> <button type="button" aria-label="分享" class="mobile-dropdown-title"><span class="title">分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/share/faq/" class="nav-link">
  FAQ
</a></li><li class="dropdown-item"><!----> <a href="/share/recommend/" class="nav-link">
  推荐
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="阅读" class="dropdown-title"><span class="title">阅读</span> <span class="arrow down"></span></button> <button type="button" aria-label="阅读" class="mobile-dropdown-title"><span class="title">阅读</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/read/effective_java.html" class="nav-link">
  Effective Java
</a></li><li class="dropdown-item"><!----> <a href="/read/clean_code.html" class="nav-link">
  代码整洁之道
</a></li><li class="dropdown-item"><!----> <a href="/read/coding_style.html" class="nav-link">
  Coding Style
</a></li><li class="dropdown-item"><!----> <a href="/read/gx.html" class="nav-link">
  高项笔记
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/wow56/wow56.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/framework/spring/" aria-current="page" class="sidebar-link">Spring 总览</a></li><li><a href="/framework/spring/spring_core.html" aria-current="page" class="active sidebar-link">Spring Core</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#参考文档" class="sidebar-link">参考文档</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#spring-core-container" class="sidebar-link">Spring Core Container</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#ioc" class="sidebar-link">IOC</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#容器实现" class="sidebar-link">容器实现</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#bean-管理" class="sidebar-link">Bean 管理</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#bean-管理-注解实现" class="sidebar-link">Bean 管理（注解实现）</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#di-自动装配-注解实现" class="sidebar-link">DI 自动装配 （注解实现）</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#条件装配" class="sidebar-link">条件装配</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#定制-bean" class="sidebar-link">定制 Bean</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#创建第三方-bean" class="sidebar-link">创建第三方 Bean</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#完全注解开发" class="sidebar-link">完全注解开发</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#bean-生命周期" class="sidebar-link">Bean 生命周期</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#循环依赖" class="sidebar-link">循环依赖</a></li></ul></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#aop" class="sidebar-link">AOP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#底层原理-代理" class="sidebar-link">底层原理-代理</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#jdk-动态代理" class="sidebar-link">JDK 动态代理</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#cglib-动态代理" class="sidebar-link">CGLIB 动态代理</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#静态代理-vs-动态代理" class="sidebar-link">静态代理 vs 动态代理</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#aop-术语" class="sidebar-link">AOP 术语</a></li></ul></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#aspectj-的使用" class="sidebar-link">AspectJ 的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#实现-aop-的两种方式" class="sidebar-link">实现 AOP 的两种方式</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#切入点表达式" class="sidebar-link">切入点表达式</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#aop-操作-基于注解" class="sidebar-link">AOP 操作（基于注解）</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#通知类型" class="sidebar-link">通知类型</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#增强内获取切入点的数据" class="sidebar-link">增强内获取切入点的数据</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#执行顺序" class="sidebar-link">执行顺序</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#切入点的抽取" class="sidebar-link">切入点的抽取</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#多个代理的执行顺序" class="sidebar-link">多个代理的执行顺序</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#注解实现-aop" class="sidebar-link">注解实现 AOP</a></li></ul></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#aspectj-切点函数" class="sidebar-link">AspectJ 切点函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#函数列表" class="sidebar-link">函数列表</a></li></ul></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#事务" class="sidebar-link">事务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#事务失效" class="sidebar-link">事务失效</a></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#解决方式" class="sidebar-link">解决方式</a></li></ul></li><li class="sidebar-sub-header"><a href="/framework/spring/spring_core.html#讨论区" class="sidebar-link">讨论区</a></li></ul></li><li><a href="/framework/spring/spring_develop.html" class="sidebar-link">Spring 开发</a></li><li><a href="/framework/spring/spring_mvc.html" class="sidebar-link">Spring MVC</a></li><li><a href="/framework/spring/spring_boot.html" class="sidebar-link">Spring Boot</a></li><li><a href="/framework/spring/spring_boot_advanced.html" class="sidebar-link">Spring Boot 进阶</a></li><li><a href="/framework/spring/spring_security.html" class="sidebar-link">Spring Security</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spring-core"><a href="#spring-core" class="header-anchor">#</a> Spring Core</h1> <blockquote><p>这里只记录 Spring 核心容器相关内容。</p></blockquote> <p><img src="/assets/img/spring-framework.cd273060.png" alt="Spring Framework"></p> <h2 id="参考文档"><a href="#参考文档" class="header-anchor">#</a> 参考文档</h2> <ul><li><a href=".">图灵-周瑜 Spring</a></li> <li><a href="https://wiki.jikexueyuan.com/project/spring/bean-life-cycle.html" target="_blank" rel="noopener noreferrer">wiki 极客学院 Spring 教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="/framework/spring/spring_core.html#/">尚硅谷-王泽 Spring</a></li> <li>笔记、示例代码资源，在<a href="https://pan.baidu.com/s/1YnZh7QdFeYfdNP9Wm6HjqQ" target="_blank" rel="noopener noreferrer">百度云<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，联系我要密码</li></ul> <h2 id="spring-core-container"><a href="#spring-core-container" class="header-anchor">#</a> Spring Core Container</h2> <ul><li>Spring Core Container 包括 Beans、Core、Context、Expression。</li> <li>本文档主要记录 IOC 和 AOP 的内容。</li></ul> <div class="custom-block tip"><p class="custom-block-title">ps</p> <p>这里的架构图是从官方 4.3.27 Doc 中找出来的，所以可能有点对不上，不过没什么大问题。</p></div> <h2 id="ioc"><a href="#ioc" class="header-anchor">#</a> IOC</h2> <p>IOC，即 Inversion Of Control，控制反转。</p> <ul><li>把对象的创建和对象之间的调用过程，交给 Spring 管理。</li> <li>使用 IOC 的目的：降低耦合。</li> <li>实际上是通过反射实现的。</li></ul> <h3 id="容器实现"><a href="#容器实现" class="header-anchor">#</a> 容器实现</h3> <p>IOC 思想基于 IOC 容器完成，IOC 容器底层就是对象工厂。</p> <p>Spring 提供了容器的两种实现方式：（两个接口）</p> <ul><li><code>BeanFactory</code> <ul><li>一般不提供给开发人员使用。</li> <li>加载配置文件的时候，不创建对象，在 <code>getBean</code> 的时候创建对象。</li></ul></li> <li><code>ApplicationContext</code> <ul><li>是 <code>BeanFactory</code> 的子接口，在 <code>BeanFactory</code> 接口之基础上做了封装，提供了更多功能。</li> <li>开发人员使用。</li> <li>分为单例和多例
<ul><li>单例
<ul><li>读取配置文件的时候，就创建对象。</li></ul></li> <li>多例
<ul><li>getBean 的时候创建对象。</li></ul></li></ul></li></ul></li></ul> <h3 id="bean-管理"><a href="#bean-管理" class="header-anchor">#</a> Bean 管理</h3> <p>分为两个操作：</p> <ul><li>创建对象</li> <li>注入属性
<ul><li>DI，依赖注入，就是注入属性的实现方式。</li></ul></li></ul> <p>两种实现方式：</p> <ul><li>基于 XML 配置文件实现</li> <li>基于注解实现</li></ul> <p>Spring 有两种类型 Bean：</p> <ul><li>普通 Bean</li> <li>FactoryBean</li></ul> <p>Spring Bean 作用域：</p> <ul><li>singleton，默认</li> <li>prototype，多实例</li></ul> <h3 id="bean-管理-注解实现"><a href="#bean-管理-注解实现" class="header-anchor">#</a> Bean 管理（注解实现）</h3> <p>该注解可以实现，将注解标注的类交给 Spring 进行管理。</p> <p>等同于在配置文件中配置： <code>&lt;bean id=&quot;...&quot; class=&quot;...&quot; /&gt;</code></p> <p>共 4 个注解：</p> <ul><li><code>@Component</code></li> <li><code>@Controller</code></li> <li><code>@Service</code></li> <li><code>@Repository</code></li></ul> <p>这里的 4 个注解，功能一样，只不过后面 3 个是语义化的。</p> <p>示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 默认的 id 值为类名首字母小写</span>
<span class="token comment">// 等同于 &lt;bean id=&quot;userService&quot; class=&quot;..&quot;/&gt;</span>

<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;userService&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;service add.......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="di-自动装配-注解实现"><a href="#di-自动装配-注解实现" class="header-anchor">#</a> DI 自动装配 （注解实现）</h3> <ul><li><p><code>@Autowired</code> 默认 byType 查找，如果找不到或者找到多个会转为 byName 去找，再找不到就报错。</p> <ul><li><p>属性 require，<code>@Autowired(require = false)</code> 的时候，先去容器里面找，找不到也不报错。</p></li> <li><p>示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/** 1 先去容器里面找 Student 的实例。
    2 第 1 步有问题的话，再按照参数名（这里是 stu）去查找
*/</span>
<span class="token annotation punctuation">@AutoWired</span>
<span class="token class-name">Student</span> stu<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul></li> <li><p><code>@Qualified</code> 按照 name，结合 <code>@Autowired</code> 使用</p> <ul><li>直接按照 qualified 的值去容器找这个名为这个值的实例。</li></ul></li> <li><p><code>@Resource</code> 默认按照 name 去查找，如果找不到或者找到多个，就转为按照 type 去找，最后都找不到就报异常。
如果 <code>@Resource</code> 注解使用了 name 属性，则只会 byName 去找，不再 byType 去找。</p></li> <li><p><code>@Value</code> 注入普通类型</p> <ul><li>使用 <code>@Value(&quot;${key}&quot;)</code>，找不到 key 对应的值，则会把 <code>${key}</code> 赋给变量。</li> <li>使用 <code>@Value(&quot;#{beanName}&quot;)</code>，可以注入 Bean。</li> <li>可以组合注解使用。</li></ul></li></ul> <blockquote><p>1 2 是 spring 包里面的，所以 spring 建议用 1 和 2。</p> <p>3 是 javax 包的注解，只不过也可以实现功能。</p></blockquote> <p>示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>（<span class="token number">1</span>）<span class="token annotation punctuation">@Autowired</span>：根据属性类型进行自动装配
<span class="token comment">// 第一步 把 service 和 dao 对象创建，在 service 和 dao 类添加创建对象注解</span>
<span class="token comment">// 第二步 在 service 注入 dao 对象，在 service 类添加 dao 类型属性，在属性上面使用注解</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
 <span class="token comment">//定义 dao 类型属性</span>
 <span class="token comment">//不需要添加 set 方法</span>
 <span class="token comment">//添加注入属性注解</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;service add.......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userDao<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

（<span class="token number">2</span>）<span class="token annotation punctuation">@Qualifier</span>：根据名称进行注入
<span class="token comment">// 这个 @Qualifier 注解的使用，和上面 @Autowired 一起使用</span>
<span class="token comment">//定义 dao 类型属性</span>
<span class="token comment">//不需要添加 set 方法</span>
<span class="token comment">//添加注入属性注解</span>
<span class="token annotation punctuation">@Autowired</span> <span class="token comment">//根据类型进行注入</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;userDaoImpl1&quot;</span><span class="token punctuation">)</span> <span class="token comment">//根据名称进行注入</span>
<span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao<span class="token punctuation">;</span>

（<span class="token number">3</span>）<span class="token annotation punctuation">@Resource</span>：可以根据类型注入，可以根据名称注入
<span class="token comment">//@Resource //根据类型进行注入</span>
<span class="token annotation punctuation">@Resource</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;userDaoImpl1&quot;</span><span class="token punctuation">)</span> <span class="token comment">//根据名称进行注入</span>
<span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao<span class="token punctuation">;</span>

（<span class="token number">4</span>）<span class="token annotation punctuation">@Value</span>：注入普通类型属性
<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="条件装配"><a href="#条件装配" class="header-anchor">#</a> 条件装配</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Bean</span>
  <span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;!test&quot;</span><span class="token punctuation">)</span>
  <span class="token class-name">ZoneId</span> <span class="token function">createZoneId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Bean</span>
  <span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
  <span class="token class-name">ZoneId</span> <span class="token function">createZoneIdForTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;America/New_York&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>如果当前的 Profile 设置为 test，则 Spring 容器会调用 <code>createZoneIdForTest()</code> 创建 ZoneId，否则，调用 <code>createZoneId()</code> 创建 ZoneId。注意到 <code>@Profile(&quot;!test&quot;)</code> 表示非 test 环境。</li> <li>在运行程序时，加上 JVM 参数 <code>-Dspring.profiles.active=test</code> 就可以指定以 test 环境启动。</li></ul> <p>实际上，Spring 允许指定多个 Profile，例如：</p> <ul><li><p><code>-Dspring.profiles.active=test,master</code></p></li> <li><p>可以表示 test 环境，并使用 master 分支代码。</p></li> <li><p>要满足多个 Profile 条件，可以这样写：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;master&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 同时满足test和master</span>
<span class="token class-name">ZoneId</span> <span class="token function">createZoneId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul> <h3 id="定制-bean"><a href="#定制-bean" class="header-anchor">#</a> 定制 Bean</h3> <p>有两种 Bean：</p> <ul><li><code>singleton</code>，单例
<ul><li>容器初始化时创建 Bean，容器关闭前销毁 Bean。</li> <li>在容器运行期间，调用 <code>getBean(Class)</code> 获取到的 Bean 总是同一个实例。</li></ul></li> <li><code>prototype</code>，原型
<ul><li><p>每次调用 <code>getBean(Class)</code>，容器都返回一个新的实例。</p></li> <li><p>声明一个 <code>Prototype</code> 的 Bean 时，需要添加一个额外的 <code>@Scope</code> 注解。</p></li> <li><p>示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableBeanFactory</span><span class="token punctuation">.</span>SCOPE_PROTOTYPE<span class="token punctuation">)</span> <span class="token comment">// @Scope(&quot;prototype&quot;)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailSession</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul></li></ul> <h3 id="创建第三方-bean"><a href="#创建第三方-bean" class="header-anchor">#</a> 创建第三方 Bean</h3> <p>如果一个 Bean 不在我们自己的 package 管理之内，例如 ZoneId，如何创建它？</p> <p>答案是我们自己在 <code>@Configuration</code> 类中编写一个 Java 方法创建并返回它，注意给方法标记一个 <code>@Bean</code> 注解：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建一个Bean</span>
  <span class="token comment">// 默认 id 是方法名小写</span>
  <span class="token annotation punctuation">@Bean</span>
  <span class="token class-name">ZoneId</span> <span class="token function">createZoneId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>Spring 对标记为 <code>@Bean</code> 的方法只调用一次，因此返回的 Bean 仍然是单例。</li> <li>创建之后使用容器获取创建的 Bean。</li></ul> <h4 id="bean"><a href="#bean" class="header-anchor">#</a> @Bean</h4> <ul><li><code>@Bean(autowireCandidate = false)</code> 表示该 Bean 不可以被注入到其他 Bean 中被使用。</li></ul> <h4 id="componentscan"><a href="#componentscan" class="header-anchor">#</a> @ComponentScan</h4> <p><code>@ComponentScan</code>，它告诉容器，自动搜索当前类所在的包以及子包，把所有标注为 <code>@Component</code> 的 Bean 自动创建出来，并根据 <code>@Autowired</code> 进行装配。</p> <p><code>@ComponentScan</code> 默认扫描指定包以及其子包下所有类，速度较慢。这时也可以选择建立<strong>扫描索引</strong>：</p> <ul><li><p>创建 <code>resources -&gt; META_INF -&gt; spring.components</code> 文件内容：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>// Key 是累的全限定路径名，Value 是注解地址
com.xxx.test.User<span class="token operator">=</span>org.springframework.stereotype.Component
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这时候只会扫描该文件进行 Bean 的注册，不再扫描包下所有文件。</p></li></ul> <h4 id="configuration"><a href="#configuration" class="header-anchor">#</a> @Configuration</h4> <p>详见<a href="/framework/spring/spring_boot.html#configuration">这里</a></p> <p>添加了这个注解就是 Full 配置 Bean（代理 Bean），其他方式均为 Lite Bean（普通 Bean）。</p> <h3 id="完全注解开发"><a href="#完全注解开发" class="header-anchor">#</a> 完全注解开发</h3> <ul><li>添加了 <code>@Configuration</code> 注解的类，就替代了 XML 配置文件。</li> <li><code>@ComponentScan</code>，它告诉容器，自动搜索当前类所在的包以及子包，把所有标注为 <code>@Component</code> 的 Bean 自动创建出来，并根据 <code>@Autowired</code> 进行装配。</li></ul> <h3 id="bean-生命周期"><a href="#bean-生命周期" class="header-anchor">#</a> Bean 生命周期</h3> <p>Spring Bean 的生命周期，从创建到销毁：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># User 类 </span>
    User.class -<span class="token operator">&gt;</span> creatingSet 中存 beanName，表示这个 bean 正在创建
    -<span class="token operator">&gt;</span> 无参构造（推断构造方法，不一定是无参） 
    -<span class="token operator">&gt;</span> 对象
    -<span class="token operator">&gt;</span> 放入 SingletonFactories 三级缓存，三级缓存中存放的是 <span class="token operator">&lt;</span>beanName, lambda<span class="token operator">&gt;</span>，lambda 中有 beanDefinition 和 无参构造创建出来的普通对象

    -<span class="token operator">&gt;</span> 依赖注入（给属性赋值）
        -<span class="token operator">&gt;</span> 单例池中取
        -<span class="token operator">&gt;</span> 判断是否出现循环依赖？如果出现循环依赖的话，需要提前进行 AOP。（单例池取不到的话，在 creatingSet 中取到了，表示出现循环依赖了，则提前进行 AOP，如果有 AOP）
        -<span class="token operator">&gt;</span> 二级缓存中取
        -<span class="token operator">&gt;</span> 三级缓存中取出来 lambda 表达式，然后执行 -<span class="token operator">&gt;</span> 生成 AOP 的代理对象 <span class="token operator">||</span> 如果不需要 AOP 的话，这里产生的就是普通对象
        -<span class="token operator">&gt;</span> 放入二级缓存 -<span class="token operator">&gt;</span> 将三级缓存中的 lambda 移除
    
    --<span class="token operator">&gt;</span> postProcessor before

    -<span class="token operator">&gt;</span> 初始化前（@PostConstruct）
    -<span class="token operator">&gt;</span> 初始化（实现 InitializingBean 重写 afterPropertiesSet<span class="token punctuation">(</span><span class="token punctuation">)</span>）
    -<span class="token operator">&gt;</span> 自定义初始化
    -<span class="token operator">&gt;</span> 初始化后（AOP）-<span class="token operator">&gt;</span> 代理对象 // 如果提前进行了 AOP 可以使用 CacheKey 在 earlyProxyReferences 中查到，如果可以查到，这里就不再执行 AOP 的操作。

    --<span class="token operator">&gt;</span> postProcessor after // AOP 就是使用后置处理器的 After 实现

    -<span class="token operator">&gt;</span> 放入 Map（单例池） 一级缓存 <span class="token operator">||</span> -<span class="token operator">&gt;</span> 从二级缓存获取代理对象放入单例池
    -<span class="token operator">&gt;</span> creatingSet.remove<span class="token punctuation">(</span>beanName<span class="token punctuation">)</span>
    -<span class="token operator">&gt;</span> Spring Bean 对象
    
    -<span class="token operator">&gt;</span> destroy
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ul><li><code>@Async</code> 和 AOP 是不同的机制。</li> <li>Spring 获取一个单例 Bean 的时候，会默认从单例池（Map）中获取，如果单例池中没有的话，则会走上述生命周期流程将 Bean 创建出来。</li> <li>推断构造方法：
<ul><li><strong>不指定</strong>使用哪个构造方法的情况（使用<code>@Autowired</code>指定）：
<ul><li>类中有多个构造方法时，Spring 默认使用类的无参构造方法，如果没有无参构造，则报错。</li> <li>只有一个有参方法不会报错，相当于添加了 <code>@Autowired</code>，因为只有一个有参构造的时候，该注解可以省略。</li></ul></li> <li><strong>指定</strong>使用哪个构造方法的情况（使用<code>@Autowired</code>指定）：
<ul><li>只有多个有参构造，必须使用 <code>@Autowired</code> 表明使用哪个构造方法，即可以没有无参构造，无限制。</li></ul></li></ul></li> <li>后置处理器（postProcessor）
<ul><li>AOP 就是基于后置处理器（After 中）实现的，AOP 就是实现了 BeanPostProcessor 接口的具体的 xxxProcessor。</li> <li>继承 <code>BeanPostProcessor</code> 接口</li> <li>实现两个方法：<code>postProcessBeforeInitialization</code> 和 <code>postProcessAfterInitialization</code>。</li></ul></li></ul> <h4 id="生命周期回调方法"><a href="#生命周期回调方法" class="header-anchor">#</a> 生命周期回调方法</h4> <p>生命周期回调方法有两种：</p> <ul><li>初始化方法：
<ul><li><code>ApplicationContext</code> 实例化 Bean 以后执行的方法，即注入属性之后执行的，set 方法之后执行的。</li></ul></li> <li>销毁方法：
<ul><li><code>ApplicationContext</code> 销毁前 调用的方法。</li></ul></li></ul> <p>主要有：</p> <ul><li>初始化 回调方法：
<ol><li>使用 <code>@PostConstruct</code> 标注的方法。<em>预初始化</em></li> <li>实现 <code>InitializingBean</code> 接口后的回调方法 <code>afterPropertiesSet()</code> 方法。<em>初始化</em></li> <li>通过 <code>init-method</code> 或 <code>default-init-method</code> 指定的方法。<em>自定义初始化</em></li></ol></li> <li>销毁 回调方法：
<ol><li>使用 <code>@PreDestroy</code> 标注的方法。</li> <li>实现 <code>DisposableBean</code> 接口后的回调方法 <code>destroy()</code> 方法。</li> <li>通过 <code>destroy-method</code> 或 <code>default-destroy-method</code> 指定的方法。</li></ol></li></ul> <h4 id="aware-接口"><a href="#aware-接口" class="header-anchor">#</a> Aware 接口</h4> <p>Aware 接口是（一个被容器管理的类）为了能够感知自身的一些属性。</p> <p>实现 Aware 接口可以实现感知自身的一些属性，可以替代构造方法自注入等注入外部 Bean 方式。</p> <h4 id="bean-加载顺序"><a href="#bean-加载顺序" class="header-anchor">#</a> Bean 加载顺序</h4> <ul><li><p>Spring Bean 生命周期流程图：</p> <p><img src="/assets/img/BeanLifecycle.26dbc4d4.jpg" alt="spring bean lifecycle"></p></li></ul> <h3 id="循环依赖"><a href="#循环依赖" class="header-anchor">#</a> 循环依赖</h3> <p>Spring 使用三级缓存解决循环依赖问题，<code>@Lazy</code> 懒加载也能解决一些循环依赖问题。</p> <blockquote><p>三级缓存解决循环依赖</p></blockquote> <p>一级缓存 单例池 <code>SingletonObjects</code></p> <p>二级缓存 早期单例（未完成初始化的对象）池 <code>earlySingletonObjects</code></p> <p>三级缓存 代理缓存池 <code>singletonFactories(&lt;beanName, lambda()&gt;)</code></p> <p>二级缓存保证早期对象唯一，如果发生了循环依赖，并且需要提前 AOP，那么会提前生成代理对象，如果一个 A 同时被 B 和 C 使用发生了循环依赖的话，那么就会在 B 和 C 的生命周期中各自创建一个 A 的代理对象，这样的话 A 就不再唯一，这时候用到了二级缓存。</p> <p>如果 User 做了 AOP 的话，那么根据Bean的生命周期，应该将 User 的代理对象存入单例池，</p> <blockquote><p>Spring 无法解决 构造方法注入 和 多例 bean 的循环依赖</p></blockquote> <p>可以使用 <code>@Lazy</code> 注解解决。</p> <p><code>@Lazy</code> 是先产生一个代理对象赋给属性，等到属性被使用的时候，才会将真正的对象创建出来。</p> <h2 id="aop"><a href="#aop" class="header-anchor">#</a> AOP</h2> <p>Aspect Oriented Programming，面向切面编程。</p> <p>面向切面的编程思想是：不改变原有代码的情况下，添加新的功能。</p> <ul><li>即：将每个部分业务逻辑进行隔离，从而使得各部分之间的耦合度降低，提高程序的可重用性，进而提高开发效率。</li></ul> <h3 id="底层原理-代理"><a href="#底层原理-代理" class="header-anchor">#</a> 底层原理-代理</h3> <p>AOP 底层使用代理实现。</p> <p>代理的实现方式：</p> <ul><li>静态代理（AspectJ）</li> <li>动态代理（Spring AOP）
<ul><li>JDK 动态代理，<strong>基于接口</strong>，适用于有接口的情况，创建接口实现类的代理实例，由代理实例去实现实现类的行为。</li> <li>CGLIB，<strong>基于父子类</strong>，适用于没有接口的情况，创建代理类继承该类。</li></ul></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>讲人话？不要急，先往下看。</p></div> <h3 id="jdk-动态代理"><a href="#jdk-动态代理" class="header-anchor">#</a> JDK 动态代理</h3> <p>适用于接口的实现类，代码结构为：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;addUser ....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>实现思想：</strong> 创建代理对象，让代理对象去替被代理的类执行它要做的事情。</p> <p>实现步骤：</p> <ul><li>创建代理类实现 <code>InvocationHandler</code> 接口</li> <li>将被代理类传入代理类，即：将自己（被代理类）的行为交给代理类去实现</li> <li>代理类返回一个被代理类的代理实例
<ul><li><em>第6行代码</em></li></ul></li> <li>代理实例执行方法，会调用代理类（实例）的 <code>invoke</code> 方法，进行代理执行</li> <li>在 <code>invoke</code> 方法中可以实现 beforeMethod 与 afterMethod 阶段的处理</li></ul> <details class="custom-block details"><summary>点击查看示例代码</summary> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDKProxy</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token class-name">JDKProxy</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token comment">// 我们在方法调用前后可以做一些处理，这实际就增强了方法。</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;调用方法之前,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;调用方法之后&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">JDKProxy</span> jdkProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JDKProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span><span class="token class-name"><span class="token namespace">jdkProxy<span class="token punctuation">.</span></span>JDKProxy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>
<span class="token comment">// 执行结果</span>
调用方法之前<span class="token punctuation">,</span>
addUser <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
调用方法之后
<span class="token number">6</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></details> <p>Proxy 类内容：</p> <ul><li>包路径：<code>java.lang.reflect.Proxy;</code></li> <li>方法：<code>newProxyInstance</code>，静态的</li> <li>3 个参数：
<ul><li><code>ClassLoader loader</code>，接口实现类的类加载器，即要代理的类的类加载器。
<ul><li>获取方式：<code>target.getClass().getClassLoader()</code></li> <li>获取该类的加载器</li></ul></li> <li><code>Class&lt;?&gt;[] interfaces</code>，接口实现类实现的接口（所有）
<ul><li>获取方式：<code>target.getClass().getInterfaces()</code></li> <li>获取该类实现的所有接口</li></ul></li> <li><code>InvocationHandler h</code>，实现了 <code>InvocationHandler</code>接口的类</li></ul></li></ul> <h3 id="cglib-动态代理"><a href="#cglib-动态代理" class="header-anchor">#</a> CGLIB 动态代理</h3> <ul><li>Cglib是无法代理final修饰的方法的。</li></ul> <p>基于父子类去生成代理：生成一个被代理类的<strong>子类</strong>进行增强。</p> <p>比如有一个类叫做 <code>UserService</code>，这个类里面有一个方法 <code>test()</code> 需要被增强。那么 CGLIB 的执行逻辑是，创建一个代理类继承该类，然后重写 <code>test()</code> 方法。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//......</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Proxy</span> <span class="token keyword">extends</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将被代理对象存储在 target 中。</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@OverWrite</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 处理增强逻辑</span>
        target<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 处理增强逻辑</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>既然 <code>Proxy</code> 类继承了被代理类，那为什么不直接使用 <code>super.test()</code>，而是将被代理对象存放到 <code>target</code> 中，然后调用 <code>target.test()</code>，因为这样的话，被代理对象可能还存储了其他信息，如果只是使用 <code>super.test()</code>，那么只是调用的一个类的方法而已。</p> <h3 id="静态代理-vs-动态代理"><a href="#静态代理-vs-动态代理" class="header-anchor">#</a> 静态代理 vs 动态代理</h3> <ul><li>静态代理
<ul><li>也称为编译时增强，即在编译阶段就可生成 AOP 代理类，也就是在编译时直接将增强部分织入 class 文件。</li> <li>在编译阶段完成，执行效率高。</li> <li>AspectJ 有自己的编译器，AspectJ compiler，简称 ajc。</li> <li>AspectJ 可以在任何类上实现。</li> <li>AspectJ 提供完整的 AOP 实现方案。</li></ul></li> <li>动态代理
<ul><li>也称为运行时增强，运行时借助于 JDK 动态代理、CGLIB 等在内存中“临时”生成 AOP 动态代理类实现。</li> <li>动态代理会增加调用栈的深度，所以效率没有静态代理高。</li> <li>Spring AOP 的编译器是 Java compiler。</li> <li>Spring AOP 只能在 Spring 容器管理的 bean 上实现代理。</li> <li>Spring AOP 只提供常用的 AOP 实现。</li></ul></li></ul> <h3 id="aop-术语"><a href="#aop-术语" class="header-anchor">#</a> AOP 术语</h3> <ul><li>JoinPoint： 连接点</li> <li>Pointcut： 切入点</li> <li>Advice： 通知/增强</li> <li>Aspect： 切面</li> <li>Target Object： 切入点所在类，被增强的对象。</li> <li>Weaving：织入</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>增强，当一个方法被代理执行的时候，我们可以选择在方法前后添加处理，这就是增强了方法。</p></div> <h4 id="joinpoint-连接点"><a href="#joinpoint-连接点" class="header-anchor">#</a> JoinPoint 连接点</h4> <p>类中哪些方法可以被增强，这些方法就叫做连接点。</p> <p>示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 这个类中的两个方法都可以进行增强，那么，这个类就有两个连接点</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="pointcut-切入点"><a href="#pointcut-切入点" class="header-anchor">#</a> Pointcut 切入点</h4> <p>实际被增强的方法，称为切入点。</p> <h4 id="advice-增强-通知"><a href="#advice-增强-通知" class="header-anchor">#</a> Advice 增强（通知）</h4> <p>方法执行前后的处理部分，就是指那些实际增强的代码部分，称为通知，即增强。</p> <p>通知有 5 种类型：</p> <ul><li>前置通知，before</li> <li>后置通知，afterReturning</li> <li>环绕通知，around</li> <li>异常通知，afterThrowing</li> <li>最终通知，after</li></ul> <h4 id="aspect-切面"><a href="#aspect-切面" class="header-anchor">#</a> Aspect 切面</h4> <p>一个动作，即：将通知应用到切入点的过程。</p> <h4 id="weaving-织入"><a href="#weaving-织入" class="header-anchor">#</a> Weaving 织入</h4> <p>将增强添加对目标类具体切入点上的过程。</p> <h2 id="aspectj-的使用"><a href="#aspectj-的使用" class="header-anchor">#</a> AspectJ 的使用</h2> <p>在 Spring 中一般借助 AspectJ 来进行更好的实现 AOP。</p> <h3 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h3> <p>AspectJ 不是 Spring 的组成部分，它是一个独立的 AOP 框架，一般使用 AspectJ 结合 Spring 一起使用，进行 AOP 操作。</p> <h3 id="实现-aop-的两种方式"><a href="#实现-aop-的两种方式" class="header-anchor">#</a> 实现 AOP 的两种方式</h3> <ul><li>基于 XML 配置文件</li> <li>基于注解</li></ul> <h3 id="切入点表达式"><a href="#切入点表达式" class="header-anchor">#</a> 切入点表达式</h3> <p>execution([权限修饰符] [返回类型] [类全路径] [方法名] ([参数列表]))</p> <p>示例：</p> <ul><li><p>对 <code>com.xxx.dao.UserDao</code> 类中的 <code>add</code> 方法进行增强。</p> <p><code>execution(* com.xxx.dao.UserDao.add(..))</code></p> <ul><li>访问修饰符可以省略，默认是 public。</li> <li>返回值可以使用 * ，表示所有的类型。</li></ul></li> <li><p>对 <code>com.xxx.dao.UserDao</code> 类中的 <strong>所有</strong> 方法进行增强。</p> <p><code>execution(* com.xxx.dao.UserDao.*(..))</code></p></li> <li><p>两个点省略参数</p></li></ul> <h3 id="aop-操作-基于注解"><a href="#aop-操作-基于注解" class="header-anchor">#</a> AOP 操作（基于注解）</h3> <ol><li><p>引入依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-aop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><p>PS：一开始这里会疑惑，因为 AspectJ 不属于 Spring，是一个独立框架，为什么只引入 <code>spring-boot-starter-aop</code>。</p></li> <li><p>这里点击进入 <code>spring-boot-starter-aop</code>，会看到其实它内部已经将 AspectJ 相关的依赖引入了：</p> <details class="custom-block details"><summary>点击查看示例代码</summary> <div class="language-xml line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.5.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-aop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.3.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.aspectj<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aspectjweaver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.9.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></details></li> <li><p>spring 的 starter 依赖会将指定场景可能用到的所有依赖添加进去。</p> <ul><li>在这里则是，<code>spring-boot-starter-aop</code>（AOP 场景 starter），集成了可能会用到的 aop 相关依赖。</li></ul></li></ul></li> <li><p>编写普通类与代理类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;add ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserProxy</span> <span class="token punctuation">{</span>
    <span class="token comment">// 前置通知</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;execution(* com.example.demo.aspect.User.add(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;before ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>
执行结果：
before <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
add <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ul><li>代理类上添加 <code>@Aspect</code>，声明这是个切面，然后使用 <code>@Component</code>，交给 Spring 容器。
<ul><li>Spring 引入 AspectJ，实质只是使用了 AspectJ 的 Library 来解析、匹配 pointcut，最终的实现还是 Spring 去做的，所以要交给 Spring 容器。</li></ul></li> <li>增强上添加对应增强/通知类型注解（往下看）</li></ul></li></ol> <h3 id="通知类型"><a href="#通知类型" class="header-anchor">#</a> 通知类型</h3> <ul><li><code>@Before</code>，待增强方法之前</li> <li><code>@After</code>，方法之后，无论异常与否，都执行(最终通知)</li> <li><code>@AfterReturning</code>，方法之后，方法正常返回后执行（后置/返回通知）</li> <li><code>@AfterThrowing</code>，异常后执行</li> <li><code>@Around</code>，环绕方法
<ul><li><p><code>ProceedingJoinPoint</code>，参数</p></li> <li><p>示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;execution(* com.example.demo.aspect.User.add(..))&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;方法前面 ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;方法后面 ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul></li></ul> <h3 id="增强内获取切入点的数据"><a href="#增强内获取切入点的数据" class="header-anchor">#</a> 增强内获取切入点的数据</h3> <p>方法内通过 JoinPoint 获取切入点的内容：</p> <ul><li>参数</li> <li>所在类</li> <li>...</li></ul> <details class="custom-block details"><summary>点击查看示例代码</summary> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;wow56&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
userService<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">--</span><span class="token operator">-</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;原始方法，第一个参数：%s，第二个参数：%d，第三个参数：%s&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>
<span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;execution(* com.example.demo.proxytest.UserService.addUser(..))&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;第一个参数：&quot;</span><span class="token operator">+</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;第二个参数：&quot;</span><span class="token operator">+</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;第三个参数：&quot;</span><span class="token operator">+</span>args<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;前置增强 ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>结果
第一个参数：hello
第二个参数：<span class="token number">56</span>
第三个参数：<span class="token class-name">User</span><span class="token punctuation">(</span>name<span class="token operator">=</span>wow56<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
前置增强 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
原始方法，第一个参数：hello，第二个参数：<span class="token number">56</span>，第三个参数：<span class="token class-name">User</span><span class="token punctuation">(</span>name<span class="token operator">=</span>wow56<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></details> <h3 id="执行顺序"><a href="#执行顺序" class="header-anchor">#</a> 执行顺序</h3> <ul><li><p>没有报异常的情况</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Around</span> 方法前面 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
before <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
我是原始方法 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">Around</span> 方法后面 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
after <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
after <span class="token class-name">Returning</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>PS：Spring 版本不同可能增强的执行顺序不一样，但是 before 一定是在 after 之前的。</p> <p>从 Spring 5.2.7 开始，通知执行的优先级顺序： Around、Before、After、AfterReturning、AfterThrowing。</p></li> <li><p>异常情况下</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Around</span> 方法前面 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
before <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
after <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
after 异常 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul> <h3 id="切入点的抽取"><a href="#切入点的抽取" class="header-anchor">#</a> 切入点的抽取</h3> <p>目的：解耦</p> <p>抽取切入点之后，只需要修改切入点就可以了。</p> <ul><li><p>使用 <code>@Pointcut</code></p> <details class="custom-block details"><summary>点击查看示例代码</summary> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserProxy</span> <span class="token punctuation">{</span>
    <span class="token comment">// 抽取切入点</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;execution(* com.example.demo.aspect.User.add(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">userAddPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 前置通知</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;userAddPoint()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;before ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 后置通知</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;userAddPoint()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;after 正常 ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;userAddPoint()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterReturning</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;after 最终 ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;userAddPoint()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterThrowing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;after 异常 ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;userAddPoint()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;方法前面 ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;方法后面 ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div></details></li></ul> <h3 id="多个代理的执行顺序"><a href="#多个代理的执行顺序" class="header-anchor">#</a> 多个代理的执行顺序</h3> <p>如果有一个 <code>UserProxy</code> 增强了 <code>User</code> 的 <code>add()</code>，这时还有一个 <code>PersonProxy</code> 也增强了 User 的 <code>add()</code>，这时候这两个代理的增强顺序就冲突了。</p> <ul><li><p>使用 <code>@Order(数字类型的值)</code>，值越小，优先级越高。</p> <ul><li><code>@Order(1)</code> 的优先级比 <code>@Order(2)</code> 的优先级高。</li></ul></li> <li><p>示例：</p> <details class="custom-block details"><summary>点击查看示例代码</summary> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserProxy</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;execution(* com.example.demo.aspect.User.add(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">userAddPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 前置通知</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;userAddPoint()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;userproxy before ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;userAddPoint()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;userProxy around before ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;userProxy around after ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PersonProxy</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;execution(* com.example.demo.aspect.User.add(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">userAddPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 前置通知</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;userAddPoint()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;personproxy before ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;userAddPoint()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;personProxy around before ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;personProxy around after ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>
userProxy around before <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
userproxy before <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
personProxy around before <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
personproxy before <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
我是原始方法 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
personProxy around after <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
userProxy around after <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div></details> <p><strong>注意：</strong> <code>Around</code> 的 <code>before</code> 和 <code>after</code> 中，</p> <ul><li>优先级高的，<code>before</code> 在前面，<code>after</code> 在后面。</li></ul></li></ul> <h3 id="注解实现-aop"><a href="#注解实现-aop" class="header-anchor">#</a> 注解实现 AOP</h3> <p><code>@annotation</code> 的作用是扫描所有添加了这个注解的方法（连接点）。</p> <ul><li>示例： <code>@annotation(com.xxx.annotation.MyAnnotation)</code></li></ul> <h4 id="无参注解"><a href="#无参注解" class="header-anchor">#</a> 无参注解</h4> <ul><li><p>无参注解和普通的用法一致,</p> <details class="custom-block details"><summary>点击查看示例代码</summary> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">MyAnnotation</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>
<span class="token annotation punctuation">@MyAnnotation</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;get 方法 。。。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAnnotationAspect</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;@annotation(com.example.demo.annotation.MyAnnotation)&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myAnnotationPointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;myAnnotationPointcut()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 使用 JoinPoint 可以获得被增强方法的入参等信息。</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;前置方法 。。。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>执行结果
前置方法 。。。
get 方法 。。。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></details></li></ul> <h4 id="有参注解"><a href="#有参注解" class="header-anchor">#</a> 有参注解</h4> <p>在 <code>@Before</code> 注解的 <code>value</code> 指定调用的切点方法，并且要加上 <code>&amp;&amp; @annotation(注解名称)</code></p> <ul><li><p>注解名称自定义，但是此处的注解名称要和增强方法的参数名一致。</p></li> <li><p>如图：</p> <p><img src="/assets/img/annotation-param.fba93597.png" alt="注解参数取值"></p> <p><strong>注意：</strong> 参数名可以自定义，但是两处要一致。</p></li></ul> <details class="custom-block details"><summary>点击查看示例代码</summary> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">MyAnnotation</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;122&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>
<span class="token annotation punctuation">@MyAnnotation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;222&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;get 方法 。。。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAnnotationAspect</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;@annotation(com.example.demo.annotation.MyAnnotation)&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myAnnotationPointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;myAnnotationPointcut() &amp;&amp; @annotation(myAnnotation)&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">MyAnnotation</span> myAnnotation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;前置方法 。。。&quot;</span> <span class="token operator">+</span> myAnnotation<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">-</span>执行结果
前置方法 。。。<span class="token number">222</span>
get 方法 。。。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></details> <h2 id="aspectj-切点函数"><a href="#aspectj-切点函数" class="header-anchor">#</a> AspectJ 切点函数</h2> <p>Spring 默认使用 AspectJ 切入点表达式语言。</p> <h3 id="函数列表"><a href="#函数列表" class="header-anchor">#</a> 函数列表</h3> <ul><li>方法切点函数
<ul><li><code>execution()</code> <ul><li>入参：方法匹配模式串</li> <li>说明：满足某一匹配模式的所有目标类方法连接点</li></ul></li> <li><code>@annotation()</code> <ul><li>入参：方法注解类名</li> <li>说明：标注了特定注解的目标方法连接点</li></ul></li></ul></li> <li>方法入参切点函数
<ul><li><code>args()</code> <ul><li>入参：类名</li> <li>说明：定位于入参为特定类型的方法的连接点</li></ul></li> <li><code>@args()</code> <ul><li>入参：类型注解类名</li> <li>说明：定位于被特定注解所标注入参的方法的连接点</li></ul></li></ul></li> <li>目标类切点函数
<ul><li><code>within()</code> <ul><li>入参：类名匹配串</li> <li>说明：定位于特定作用域下的所有连接点</li></ul></li> <li><code>target()</code> <ul><li>入参：类名</li> <li>说明：定位于指定类及其子类</li></ul></li> <li><code>@within()</code> <ul><li>入参：类型注解类名</li> <li>说明：定位与标注了特定注解的类及其实现类</li></ul></li> <li><code>@target()</code> <ul><li>入参：类型注解类名</li> <li>说明：定位于标注了特定注解的目标类里所有方法</li></ul></li></ul></li> <li>代理类切点函数
<ul><li><code>this()</code> <ul><li>入参：类名</li> <li>说明：代理类按类型匹配与指定类，则被代理的目标类的所有连接点都匹配与该切点</li></ul></li></ul></li></ul> <h2 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h2> <p>如果一个类的某个方法上添加了 <code>@Transactional</code> 注解，那么这个类就会产生一个代理对象，方法执行的是代理对象的方法。</p> <p>事务管理器新建一个数据库连接 conn -&gt; 放到 ThreadLocal 中，<code>conn.autocommit = false</code>，关闭自动提交后，将所有的 sql 先存在起来，如果方法不报错，那么将这些 sql 提交，否则 rollback。</p> <h3 id="事务失效"><a href="#事务失效" class="header-anchor">#</a> 事务失效</h3> <p>执行的普通类，而不是代理类，导致事务失效，可以注入自身。</p> <p>一个添加了 <code>@Transactional</code> 注解的方法中，调用了自身的方法，这时候，被调用的自身的那个方法，实际上是被普通对象调用的，而不是 单例池中的代理对象调用的。如果不是 Spring 管理的类，那么就不会走代理逻辑，那么注解自然就失效了。</p> <p><code>@Configuration</code> 注解类也是代理类</p> <h3 id="解决方式"><a href="#解决方式" class="header-anchor">#</a> 解决方式</h3> <ul><li>自己注入自己（Spring 允许的）</li> <li><code>AopContext.currentProxy()</code> 获取代理对象使用代理对象执行逻辑。</li></ul> <h2 id="讨论区"><a href="#讨论区" class="header-anchor">#</a> 讨论区</h2> <blockquote><p>由于评论过多会影响页面最下方的导航，故将评论区做默认折叠处理。</p></blockquote> <details class="custom-block details"><summary>点击查看评论区内容，渴望您的宝贵建议~</summary> <!----></details></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/27/2023, 9:12:38 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/framework/spring/" class="prev router-link-active">
        Spring 总览
      </a></span> <span class="next"><a href="/framework/spring/spring_develop.html">
        Spring 开发
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5780eb53.js" defer></script><script src="/assets/js/2.e1f1d232.js" defer></script><script src="/assets/js/11.00deed7e.js" defer></script>
  </body>
</html>
