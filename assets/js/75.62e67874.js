(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{556:function(t,s,a){"use strict";a.r(s);var n=a(48),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"mongodb-基础"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-基础"}},[t._v("#")]),t._v(" MongoDB 基础")]),t._v(" "),a("h2",{attrs:{id:"参考文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[t._v("#")]),t._v(" 参考文档")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.mongodb.com/manual/",target:"_blank",rel:"noopener noreferrer"}},[t._v("MongoDB"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://docs.mongoing.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("MongoDB 中文文档"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://mongodb.net.cn/manual/reference/method/db.collection.insert/",target:"_blank",rel:"noopener noreferrer"}},[t._v("MongoDB 中文手册"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("p",[t._v("// TODO")]),t._v(" "),a("h2",{attrs:{id:"连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#连接"}},[t._v("#")]),t._v(" 连接")]),t._v(" "),a("p",[t._v("使用连接字符串方式：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v('mongo "mongodb://host:port"')])]),t._v(" "),a("li",[a("code",[t._v('mongo "mongodb://user:pwd@host:port/db_name?authSource=admin...(即 options)"')])])]),t._v(" "),a("h2",{attrs:{id:"bson"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bson"}},[t._v("#")]),t._v(" BSON")]),t._v(" "),a("ul",[a("li",[t._v("binary json。")]),t._v(" "),a("li",[t._v("BSON 文档的最大大小为 16 MB。")])]),t._v(" "),a("h3",{attrs:{id:"objectid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#objectid"}},[t._v("#")]),t._v(" ObjectId")]),t._v(" "),a("p",[t._v("ObjectId 很小，可能唯一，可以快速生成并排序。ObjectId 值的长度为 12 个字节，包括：")]),t._v(" "),a("ul",[a("li",[t._v("一个 4 字节的_时间戳记值_，代表自 Unix 时代以来以秒为单位的 ObjectId 的创建。")]),t._v(" "),a("li",[t._v("5 字节_随机值_。")]),t._v(" "),a("li",[t._v("3 字节_递增计数器_，初始化为随机值。")])]),t._v(" "),a("p",[t._v("在 mongoshell 中，可以使用 "),a("code",[t._v("ObjectId.getTimestamp()")]),t._v(" 方法访问 ObjectId 的创建时间。")]),t._v(" "),a("p",[t._v("在存储 ObjectId 值的 "),a("code",[t._v("_id")]),t._v(" 字段上按大致相当于创建时间进行排序。")]),t._v(" "),a("p",[a("strong",[t._v("重要：")]),t._v(" 尽管 ObjectId 值应随时间增加，但不一定是单调的。这是因为他们仅包含一秒的时间分辨率，因此在同一秒内创建的 ObjectId 值没有保证的顺序，并且由客户端生成，客户端可能具有不同的系统时钟。")]),t._v(" "),a("h3",{attrs:{id:"字符串"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#字符串"}},[t._v("#")]),t._v(" 字符串")]),t._v(" "),a("p",[t._v("BSON 字符串为 "),a("code",[t._v("UTF-8")]),t._v("。通常，在对 BSON 进行序列化和反序列化时，每种编程语言的驱动程序都会从该语言的字符串格式转换为 "),a("code",[t._v("UTF-8")]),t._v("。这样就可以轻松地将大多数国际字符存储在 BSON 字符串中。")]),t._v(" "),a("p",[t._v("此外，MongoDB "),a("code",[t._v("$regex")]),t._v(" 查询在正则表达式字符串中支持 "),a("code",[t._v("UTF-8")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"日期-date"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日期-date"}},[t._v("#")]),t._v(" 日期 Date")]),t._v(" "),a("p",[t._v("BSON Date 是一个 64 位整数，代表自 Unix 纪元（1970年1月1日）以来的毫秒数。这导致可以追溯到过去和未来约 2.9 亿年的日期范围。")]),t._v(" "),a("p",[t._v("官方 BSON 规范指的是 BSON Date 类型为 "),a("code",[t._v("UTC日期时间")]),t._v("。")]),t._v(" "),a("p",[t._v("BSON 日期类型是有符号整数。负值表示 1970 年之前的日期。")]),t._v(" "),a("p",[t._v("示例：")]),t._v(" "),a("ul",[a("li",[t._v("在 mongo shell 中使用构造函数 "),a("code",[t._v("new Date()")]),t._v(" 构造一个 Date ："),a("code",[t._v("var mydate1 = new Date()")]),t._v("。")]),t._v(" "),a("li",[t._v("在 mongo shell 中使用构造函数 "),a("code",[t._v("ISODate()")]),t._v(" 构造一个 Date ："),a("code",[t._v("var mydate2 = ISODate()")]),t._v("。")]),t._v(" "),a("li",[t._v("以字符串形式返回 Date 值："),a("code",[t._v("mydate1.toString()")]),t._v("。")]),t._v(" "),a("li",[t._v("返回日期值的月份部分，月是零索引，因此一月是 0 月："),a("code",[t._v("mydate1.getMonth()")]),t._v("。")])]),t._v(" "),a("h2",{attrs:{id:"库操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#库操作"}},[t._v("#")]),t._v(" 库操作")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("db")]),t._v("，查看当前数据库。")]),t._v(" "),a("li",[a("code",[t._v("show dbs")])]),t._v(" "),a("li",[a("code",[t._v("use db_name")])]),t._v(" "),a("li",[a("code",[t._v("db.dropDatabase()")]),t._v("，删除当前使用的数据库。")])]),t._v(" "),a("p",[t._v("MongoDB 中直接创建一条数据，如果对应的表不存在就会被创建出来。")]),t._v(" "),a("p",[t._v("比如："),a("code",[t._v('db.user.insertOne({name:"xiaoming"})')]),t._v("，该命令会同步创建 user 集合（表），如果之前不存在的话。"),a("code",[t._v("use Haha")]),t._v("，就会将 Haha 库创建出来。")]),t._v(" "),a("h2",{attrs:{id:"集合操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集合操作"}},[t._v("#")]),t._v(" 集合操作")]),t._v(" "),a("ul",[a("li",[t._v("显示所有集合， "),a("code",[t._v("show collections")])]),t._v(" "),a("li",[t._v("创建集合， "),a("code",[t._v("db.createCollection('collection',[options])")])]),t._v(" "),a("li",[t._v("删除集合， "),a("code",[t._v("db.collection.drop()")])])]),t._v(" "),a("h2",{attrs:{id:"文档操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文档操作"}},[t._v("#")]),t._v(" 文档操作")]),t._v(" "),a("p",[a("code",[t._v("db.collection.action()")]),t._v(":")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("find(query, projection).pretty()")]),t._v("，\n"),a("ul",[a("li",[t._v("默认返回 20 条数据。")]),t._v(" "),a("li",[t._v("返回值是一个 cursor。")]),t._v(" "),a("li",[a("code",[t._v("query")]),t._v(" 是查询条件，")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("projection")]),t._v(" 控制字段的显示和隐藏")]),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("pretty")]),t._v(" 是格式化。")]),t._v(" "),a("li",[a("code",[t._v("sort")]),t._v("，1 正序， -1 倒序。")]),t._v(" "),a("li",[a("code",[t._v("skip")]),t._v("，跳过几个。")]),t._v(" "),a("li",[a("code",[t._v("limit")]),t._v("，控制返回条数。")])])]),t._v(" "),a("li",[a("code",[t._v("insert(params)")]),t._v("，"),a("code",[t._v("params")]),t._v(" 可以是对象，也可以是数组类型。")]),t._v(" "),a("li",[a("code",[t._v("remove(query)")]),t._v("， "),a("code",[t._v("query")]),t._v(" 是查询条件。")]),t._v(" "),a("li",[a("code",[t._v("update(query, update, [options])")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("$set")]),t._v("、"),a("code",[t._v("$inc")]),t._v("、"),a("code",[t._v("$pull")]),t._v("、"),a("code",[t._v("$push")]),t._v("。")])])])]),t._v(" "),a("h2",{attrs:{id:"插入文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插入文档"}},[t._v("#")]),t._v(" 插入文档")]),t._v(" "),a("blockquote",[a("p",[t._v("如果该集合当前不存在，则插入操作将创建该集合。")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("db.collection.insert(one or more)")]),t._v("，一个 or 多个对象数组。")]),t._v(" "),a("li",[a("code",[t._v("db.collection.insertOne({})")]),t._v("，一个对象。")]),t._v(" "),a("li",[a("code",[t._v("db.collection.insertMany([{},{}])")]),t._v("，对象数组。")])]),t._v(" "),a("p",[t._v("另外：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("db.collection.save()")]),t._v("，如果包含 "),a("code",[t._v("_id")]),t._v("，执行 update，如果不包含，则执行创建。")]),t._v(" "),a("li",[t._v("...")])]),t._v(" "),a("h2",{attrs:{id:"查询文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询文档"}},[t._v("#")]),t._v(" 查询文档")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("db.collection.find()")]),t._v("，返回游标 <==> "),a("code",[t._v("SELECT * FROM tb")]),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("db.collection.findOne()")]),t._v("，返回文档。")])]),t._v(" "),a("h3",{attrs:{id:"查询操作符"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询操作符"}},[t._v("#")]),t._v(" 查询操作符")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("$or")]),t._v(" "),a("code",[t._v("$and")]),t._v(" "),a("code",[t._v("$not")]),t._v(" "),a("code",[t._v("$nor")]),t._v("，值是一个数组类型。")]),t._v(" "),a("li",[a("code",[t._v("$eq")]),t._v("、"),a("code",[t._v("$gt")]),t._v("、"),a("code",[t._v("$gte")]),t._v("、"),a("code",[t._v("$in")]),t._v("、"),a("code",[t._v("$lt")]),t._v("、"),a("code",[t._v("$lte")]),t._v("、"),a("code",[t._v("$ne")]),t._v("、"),a("code",[t._v("$nin")]),t._v("，"),a("code",[t._v("regex")]),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("$elemMatch")]),t._v("，匹配对象数组。")])]),t._v(" "),a("h3",{attrs:{id:"in"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#in"}},[t._v("#")]),t._v(" $in")]),t._v(" "),a("p",[t._v("查找集合中 status = A 或 D 的所有文档：")]),t._v(" "),a("p",[a("code",[t._v('db.collection.find( { status: { $in: [ "A", "D" ] } } )')]),t._v(" <==> "),a("code",[t._v('SELECT * FROM tb WHERE status in ("A", "D")')])]),t._v(" "),a("h3",{attrs:{id:"and"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#and"}},[t._v("#")]),t._v(" $and")]),t._v(" "),a("p",[t._v("查找集合中 status = A 并且 qty <($lt) 30 的所有文档:")]),t._v(" "),a("p",[a("code",[t._v('db.collection.find( { status: "A", qty: { $lt: 30 } } )')]),t._v(" <==> "),a("code",[t._v('SELECT * FROM tb WHERE status = "A" AND qty < 30')])]),t._v(" "),a("h3",{attrs:{id:"or"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#or"}},[t._v("#")]),t._v(" $or")]),t._v(" "),a("p",[t._v("查找集合中 status = A 或者 qty <($lt) 30 的所有文档:")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("collection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n    $or"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" status"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" qty"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" $lt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// <==> SELECT * FROM db WHERE status = "A" OR qty < 30')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// And 操作与 Or 操作一样，也可以写成 $and:[{..},{..},...] 的形式，但可省略。")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("h3",{attrs:{id:"控制返回字段-projection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#控制返回字段-projection"}},[t._v("#")]),t._v(" 控制返回字段/projection")]),t._v(" "),a("blockquote",[a("p",[t._v("_id 默认返回，除_id 字段外，不能在映射文档中同时使用包含和去除语句！！！")])]),t._v(" "),a("h4",{attrs:{id:"所有字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#所有字段"}},[t._v("#")]),t._v(" 所有字段")]),t._v(" "),a("p",[t._v("如果没有指定 "),a("code",[t._v("projection")]),t._v(","),a("code",[t._v("find()")]),t._v(" 会返回文档的所有字段。")]),t._v(" "),a("p",[a("code",[t._v('db.collection.find( { status: "A" } )')]),t._v(" <==> "),a("code",[t._v('SELECT * from tb WHERE status = "A"')])]),t._v(" "),a("h4",{attrs:{id:"仅返回指定字段和-id字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#仅返回指定字段和-id字段"}},[t._v("#")]),t._v(" 仅返回指定字段和_id字段")]),t._v(" "),a("p",[a("code",[t._v('db.collection.find( { status: "A" }, { item: 1, status: 1 } )')]),t._v(" <==> "),a("code",[t._v('SELECT _id, item, status from tb WHERE status = "A"')])]),t._v(" "),a("h4",{attrs:{id:"去除-id字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#去除-id字段"}},[t._v("#")]),t._v(" 去除_id字段")]),t._v(" "),a("p",[a("code",[t._v('db.collection.find( { status: "A" }, { item: 1, status: 1, _id: 0 } )')]),t._v(" <==> "),a("code",[t._v('SELECT item, status from tb WHERE status = "A"')])]),t._v(" "),a("h4",{attrs:{id:"去除指定字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#去除指定字段"}},[t._v("#")]),t._v(" 去除指定字段")]),t._v(" "),a("blockquote",[a("p",[t._v("除 _id 字段外，不能在映射文档中同时使用包含和去除语句。")])]),t._v(" "),a("p",[a("code",[t._v('db.collection.find( { status: "A" }, { status: 0, instock: 0 } )')])]),t._v(" "),a("h3",{attrs:{id:"查询空字段或缺少字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询空字段或缺少字段"}},[t._v("#")]),t._v(" 查询空字段或缺少字段")]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("$exist")]),t._v(" 查询不包含 age 字段的文档：")]),t._v(" "),a("p",[a("code",[t._v("db.collection.find( { age : { $exists: false } } )")])]),t._v(" "),a("h3",{attrs:{id:"数组查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数组查询"}},[t._v("#")]),t._v(" 数组查询")]),t._v(" "),a("p",[t._v("首先造一些实验数据：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("inventory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertMany")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" item"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"journal"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tags"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"blank"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"red"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dim_cm"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" item"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"notebook"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tags"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"red"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"blank"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dim_cm"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" item"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"paper"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tags"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"red"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"blank"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"plain"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dim_cm"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" item"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"planner"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tags"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"blank"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"red"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dim_cm"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22.85")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" item"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"postcard"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("45")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tags"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"blue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dim_cm"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15.25")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("h4",{attrs:{id:"单条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单条件"}},[t._v("#")]),t._v(" 单条件")]),t._v(" "),a("ol",[a("li",[a("p",[t._v('查询数组字段 tags 值只包含两个元素 "red","blank" 并且有'),a("strong",[t._v("指定顺序")]),t._v("的数组的所有文档:")]),t._v(" "),a("p",[a("code",[t._v('db.inventory.find( { tags: ["red", "blank"] } )')])])]),t._v(" "),a("li",[a("p",[t._v('查询数组中包含 "red","blank" 两个元素并且'),a("strong",[t._v("不在乎元素顺序或者数组中是否有其它元素")]),t._v("。可以使用 "),a("code",[t._v("$all")]),t._v(" 操作符:")]),t._v(" "),a("p",[a("code",[t._v('db.inventory.find( { tags: { $all: ["red", "blank"] } } )')])])]),t._v(" "),a("li",[a("p",[t._v('查询数组字段 tags 中有一个元素的值是 "red" 的所有文档:')]),t._v(" "),a("p",[a("code",[t._v('db.inventory.find( { tags: "red" } )')])])]),t._v(" "),a("li",[a("p",[t._v("查询数组字段 dim_cm 中最少有一个元素的值 >25 的所有文档：")]),t._v(" "),a("p",[a("code",[t._v("db.inventory.find( { dim_cm: { $gt: 25 } } )")])])])]),t._v(" "),a("h4",{attrs:{id:"多条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多条件"}},[t._v("#")]),t._v(" 多条件")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("满足任一：")]),t._v(" 查询数组字段 dim_cm 中单个元素同时满足 >15 并且 <20，或者一个元素满足 >15，另外一个元素 <20 的所有文档:")]),t._v(" "),a("p",[a("code",[t._v("db.inventory.find( { dim_cm: { $gt: 15, $lt: 20 } } )")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("全满足：")]),t._v(" 查询数组字段 dim_cm 中最少一个元素同时满足 >($gt)22 并且 <($lt) 30:")]),t._v(" "),a("p",[a("code",[t._v("db.inventory.find( { dim_cm: { $elemMatch: { $gt: 22, $lt: 30 } } } )")])]),t._v(" "),a("p",[t._v("使用"),a("code",[t._v("$elemMatch")]),t._v("来指定多个查询条件在数组中的元素上，数组中最少一个元素同时满足所有的查询条件。")])])]),t._v(" "),a("h4",{attrs:{id:"使用数组长度来检索"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用数组长度来检索"}},[t._v("#")]),t._v(" 使用数组长度来检索")]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("$size")]),t._v(" 操作符通过数组中的元素个数来进行检索。")]),t._v(" "),a("p",[t._v("查询数组字段 tags 中有三个元素的所有文档： "),a("code",[t._v('db.inventory.find( { "tags": { $size: 3 } } )')]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"查询嵌入式对象数组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询嵌入式对象数组"}},[t._v("#")]),t._v(" 查询嵌入式对象数组")]),t._v(" "),a("p",[t._v("首先造一些实验数据：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("inventory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertMany")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" item"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"journal"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" instock"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" warehouse"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" warehouse"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" item"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"notebook"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" instock"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" warehouse"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" item"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"paper"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" instock"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" warehouse"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" warehouse"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"B"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" item"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"planner"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" instock"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" warehouse"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("40")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" warehouse"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"B"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" item"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"postcard"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" instock"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" warehouse"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"B"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" warehouse"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qty"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("35")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("ol",[a("li",[a("p",[t._v("查询 instock 数组中元素等于指定文档的的所有文档:")]),t._v(" "),a("p",[t._v("正确的是："),a("code",[t._v('db.inventory.find( { "instock": { warehouse: "A", qty: 5 } } )')]),t._v("。")]),t._v(" "),a("p",[t._v("当对整个嵌套文档使用等值匹配的时候是要求精确匹配指定文档，"),a("strong",[t._v("包括字段顺序")]),t._v("。比如，下面的语句并没有查询到 inventory 集合中的任何文档："),a("code",[t._v('db.inventory.find( { "instock": { qty: 5, warehouse: "A" } } )')]),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("查询 instock 数组中的第一个元素是包含字段 qty <= 20 的所有文档：")]),t._v(" "),a("p",[a("code",[t._v("db.inventory.find( { 'instock.0.qty': { $lte: 20 } } )")])]),t._v(" "),a("p",[a("strong",[t._v("注意：")]),t._v(" 当查询使用点号"),a("code",[t._v(".")]),t._v("的时候，字段和索引必须在引号内。")])]),t._v(" "),a("li",[a("p",[t._v("使用 "),a("code",[t._v("$elemMatch")]),t._v(" 操作符为数组中的嵌套文档指定多个查询条件，最少一个嵌套文档同时满足所有的查询条件。")])])]),t._v(" "),a("h2",{attrs:{id:"更新文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新文档"}},[t._v("#")]),t._v(" 更新文档")]),t._v(" "),a("p",[t._v("更新方法定义：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("collection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("update"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可选。如果设置为 true，则在没有文档符合查询条件时创建一个新文档。默认值为 false。")]),t._v("\n        upsert"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("boolean"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可选。如果设置为 true，则更新满足 query 条件的多个文档。如果设置为false，则更新一个文档。默认值为false。")]),t._v("\n        multi"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("boolean"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        writeConcern"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        collation"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        arrayFilters"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("filterdocument1"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        hint"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("string"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Available starting in MongoDB 4.2")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("p",[t._v("主要方法有：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("db.collection.update()")])]),t._v(" "),a("li",[a("code",[t._v("db.collection.updateOne()")])]),t._v(" "),a("li",[a("code",[t._v("db.collection.updateMany()")])]),t._v(" "),a("li",[a("code",[t._v("db.collection.replaceOne()")])])]),t._v(" "),a("p",[a("strong",[t._v("附加方法：")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("db.collection.save()")])]),t._v(" "),a("li",[a("code",[t._v("db.collection.findAndModify()")])]),t._v(" "),a("li",[a("code",[t._v("db.collection.findOneAndUpdate()")])]),t._v(" "),a("li",[a("code",[t._v("db.collection.findOneAndReplace()")])]),t._v(" "),a("li",[a("code",[t._v("db.collection.bulkWrite()")])])]),t._v(" "),a("h3",{attrs:{id:"更新操作符"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新操作符"}},[t._v("#")]),t._v(" 更新操作符")]),t._v(" "),a("p",[a("code",[t._v("$set")]),t._v("、"),a("code",[t._v("$unset")]),t._v(" "),a("em",[t._v("移除字段")]),t._v("、"),a("code",[t._v("$inc")]),t._v("、"),a("code",[t._v("$pull")]),t._v("、"),a("code",[t._v("$push")]),t._v("。")]),t._v(" "),a("p",[t._v("不加操作符，就是全量替换。")]),t._v(" "),a("p",[t._v("示例：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("将 _id=15 的用户 name 修改为 xiaoming：")]),t._v(" "),a("p",[a("code",[t._v('db.user.updateOne( { _id: 15 }, { $set: { "name": "xiaoming"} })')])])])]),t._v(" "),a("h2",{attrs:{id:"删除文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除文档"}},[t._v("#")]),t._v(" 删除文档")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("db.collection.deleteOne()")])]),t._v(" "),a("li",[a("code",[t._v("db.collection.deleteMany()")])])]),t._v(" "),a("h2",{attrs:{id:"游标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#游标"}},[t._v("#")]),t._v(" 游标")]),t._v(" "),a("p",[t._v("在 mongo shell 脚本中打印结果游标中的所有项目，请使用以下惯用法：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("cursor "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("collection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" cursor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasNext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printjson")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" cursor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("也可以使用游标方法 "),a("code",[t._v("forEach()")]),t._v(" 来迭代游标并访问文档，如下例所示:")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" myCursor "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("  db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmyCursor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("printjson"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h2",{attrs:{id:"讨论区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#讨论区"}},[t._v("#")]),t._v(" 讨论区")]),t._v(" "),a("blockquote",[a("p",[t._v("由于评论过多会影响页面最下方的导航，故将评论区做默认折叠处理。")])]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("点击查看评论区内容，渴望您的宝贵建议~")]),t._v(" "),a("Vssue",{attrs:{title:t.$title,options:{locale:"zh"}}})],1)])}),[],!1,null,null,null);s.default=e.exports}}]);