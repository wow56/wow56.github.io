(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{568:function(s,a,e){"use strict";e.r(a);var t=e(48),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"redis-安装配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis-安装配置"}},[s._v("#")]),s._v(" Redis 安装配置")]),s._v(" "),e("h2",{attrs:{id:"参考文档"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[s._v("#")]),s._v(" 参考文档")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://www.runoob.com/docker/docker-install-redis.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("菜鸟 Docker 安装 Redis"),e("OutboundLink")],1)])]),s._v(" "),e("h2",{attrs:{id:"docker-安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-安装"}},[s._v("#")]),s._v(" Docker 安装")]),s._v(" "),e("blockquote",[e("p",[s._v("还不会 Docker？"),e("RouterLink",{attrs:{to:"/applied-tech/docker/"}},[s._v("Docker 是啥")])],1)]),s._v(" "),e("h3",{attrs:{id:"无密码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#无密码"}},[s._v("#")]),s._v(" 无密码")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("docker search redis\ndocker pull redis\ndocker run -itd --name redis-test -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(":6379 redis\ndocker "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it redis-test /bin/bash\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" redis-cli\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" keys *\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h3",{attrs:{id:"有密码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#有密码"}},[s._v("#")]),s._v(" 有密码")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("docker search redis\ndocker pull redis\ndocker run -itd --name redis-test -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(":6379 redis --requirepass "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"password"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加密码后进入容器")]),s._v("\ndocker "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it redis-test /bin/bash\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" redis-cli\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里直接使用会报错")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" keys *\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 需要认证后才可以")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" auth "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"password"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" keys *\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h2",{attrs:{id:"源码安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#源码安装"}},[s._v("#")]),s._v(" 源码安装")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://redis.io/docs/install/install-redis/install-redis-from-source/",target:"_blank",rel:"noopener noreferrer"}},[s._v("源码安装方式"),e("OutboundLink")],1)]),s._v(" "),e("ol",[e("li",[s._v("下载源码 redis-xxx.tar.gz 。")]),s._v(" "),e("li",[s._v("将压缩包放在 "),e("code",[s._v("/usr/local/")]),s._v(" 下。")]),s._v(" "),e("li",[s._v("解压 "),e("code",[s._v("tar -xzvf redis-xxx.tar.gz")])]),s._v(" "),e("li",[e("code",[s._v("cd redis-xxx")])]),s._v(" "),e("li",[e("code",[s._v("make")])]),s._v(" "),e("li",[e("code",[s._v("make install")])]),s._v(" "),e("li",[e("code",[s._v("redis-server")]),s._v(" 启动")])]),s._v(" "),e("h3",{attrs:{id:"配置密码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置密码"}},[s._v("#")]),s._v(" 配置密码")]),s._v(" "),e("ol",[e("li",[s._v("进入 "),e("code",[s._v("/usr/local/redis-xxx/")]),s._v("，找到 "),e("code",[s._v("redis.conf")])]),s._v(" "),e("li",[s._v("进入 "),e("code",[s._v("vi")]),s._v(" 中，按下 "),e("code",[s._v("/")]),s._v("，然后输入 "),e("code",[s._v("requirepass")]),s._v("，找到这行，然后取消注释，把密码加上，重启服务。")])]),s._v(" "),e("h3",{attrs:{id:"添加-systemd-服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#添加-systemd-服务"}},[s._v("#")]),s._v(" 添加 systemd 服务")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("进入 "),e("code",[s._v("/usr/local/redis-xxx/")]),s._v("，找到 "),e("code",[s._v("redis.conf")])])]),s._v(" "),e("li",[e("p",[s._v("将配置文件中的 "),e("code",[s._v("daemonize no")]),s._v(" 改成 "),e("code",[s._v("daemonize yes")])])]),s._v(" "),e("li",[e("p",[s._v("在 "),e("code",[s._v("/etc/systemd/system/")]),s._v(" 创建 "),e("code",[s._v("redis.service")]),s._v(" 文件")]),s._v(" "),e("ul",[e("li",[e("RouterLink",{attrs:{to:"/computer-literacy/linux/using_linux.html#添加-unit"}},[s._v("添加 Unit")])],1)]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意修改目录")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Redis\n    "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network.target\n\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forking\n    "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/redis/bin/redis-server /usr/local/redis/bin/redis.conf\n    "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecReload")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/redis/bin/redis-server -s reload\n    "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStop")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/redis/bin/redis-server -s stop\n    "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PrivateTmp")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("systemctl enable redis")])])])]),s._v(" "),e("h2",{attrs:{id:"主从复制模式安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#主从复制模式安装"}},[s._v("#")]),s._v(" 主从复制模式安装")]),s._v(" "),e("ol",[e("li",[s._v("首先安装 Redis")])]),s._v(" "),e("p",[s._v("使用 3 台服务器，分别安装 Redis:")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("no")]),s._v(" "),e("th",[s._v("ip")]),s._v(" "),e("th",[s._v("port")]),s._v(" "),e("th",[s._v("role")]),s._v(" "),e("th",[s._v("permission")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("1")]),s._v(" "),e("td",[s._v("192.168.1.1")]),s._v(" "),e("td",[s._v("6379")]),s._v(" "),e("td",[s._v("master")]),s._v(" "),e("td",[s._v("读、写")])]),s._v(" "),e("tr",[e("td",[s._v("2")]),s._v(" "),e("td",[s._v("192.168.1.2")]),s._v(" "),e("td",[s._v("6379")]),s._v(" "),e("td",[s._v("slave")]),s._v(" "),e("td",[s._v("读")])]),s._v(" "),e("tr",[e("td",[s._v("3")]),s._v(" "),e("td",[s._v("192.168.1.3")]),s._v(" "),e("td",[s._v("6379")]),s._v(" "),e("td",[s._v("slave")]),s._v(" "),e("td",[s._v("读")])])])]),s._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[s._v("修改配置文件")])]),s._v(" "),e("p",[s._v("Master 主节点配置如下：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis进程是否以守护进程的方式运行，yes为是，no为否。默认为no(不以守护进程的方式运行会占用一个终端)。")]),s._v("\ndaemonize "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否开启保护模式，默认开启。要是配置里没有指定bind和密码。开启该参数后，redis只会本地进行访问，拒绝外部访问。要是开启了密码和指定bind，可以开启。否则最好关闭设置为no。")]),s._v("\nprotected-mode "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 绑定的主机地址，这里需要根据实际IP进行配置")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.1\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis进程的端口号")]),s._v("\nport "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# log文件输出位置，如果进程以守护进程的方式运行，此处又将输出文件设置为stdout的话，就会将日志信息输出到/dev/null里面去了")]),s._v("\nlogfile /xxxxx/redis.log\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置redis连接密码，如果配置了连接密码，客户端在连接redis是需要通过AUTH<password>命令提供密码，默认关闭")]),s._v("\nrequirepass xxxxxx\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当master设置了密码保护时，slave服务连接master的密码")]),s._v("\nmasterauth "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("master-password"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("p",[s._v("Slave 从节点配置如下：")]),s._v(" "),e("blockquote",[e("p",[s._v("与主节点配置相似，仅多配置一项 "),e("code",[s._v("replicaof")]),s._v(" 指定主节点 IP、端口")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis进程是否以守护进程的方式运行，yes为是，no为否。默认为no(不以守护进程的方式运行会占用一个终端)。")]),s._v("\ndaemonize "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否开启保护模式，默认开启。要是配置里没有指定bind和密码。开启该参数后，redis只会本地进行访问，拒绝外部访问。要是开启了密码和指定bind，可以开启。否则最好关闭设置为no。")]),s._v("\nprotected-mode "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 绑定的主机地址，这里需要根据实际IP进行配置")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.1\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis进程的端口号")]),s._v("\nport "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# log文件输出位置，如果进程以守护进程的方式运行，此处又将输出文件设置为stdout的话，就会将日志信息输出到/dev/null里面去了")]),s._v("\nlogfile /xxxxx/redis.log\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置redis连接密码，如果配置了连接密码，客户端在连接redis是需要通过AUTH<password>命令提供密码，默认关闭")]),s._v("\nrequirepass xxxxxx\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当master设置了密码保护时，slave服务连接master的密码")]),s._v("\nmasterauth "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("master-password"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定当本机为slave服务时，设置master服务的IP地址及端口，在redis启动的时候他会自动跟master进行数据同步")]),s._v("\nreplicaof "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("masterip"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("masterport"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("p",[e("strong",[s._v("注意：")]),s._v(" 由于搭建的集群需要自动容灾切换，主数据库可能会变成从数据库，所以三台机器上都需要同时设置 "),e("code",[s._v("requirepass")]),s._v(" 和 "),e("code",[s._v("masterauth")]),s._v(" 配置项。")]),s._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[s._v("数据同步")])]),s._v(" "),e("blockquote",[e("p",[s._v("以上配置修改后，重启 Redis 服务。")]),s._v(" "),e("p",[s._v("如果开启了防火墙则需要放行相应端口：")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查防火墙是否开启：")]),s._v("\nsystemctl status firewalld\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dead : 未开启状态")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# running : 开启状态")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启防火墙：")]),s._v("\nsystemctl start firewalld\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确认防火墙是否开启")]),s._v("\nsystemctl status firewalld\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置防火墙放行 6379 端口")]),s._v("\nfirewall-cmd --add-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("/tcp --permanent --zone"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 成功后出现 success，然后重启防火墙，三台都需要配置")]),s._v("\nfirewall-cmd --reload\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("blockquote",[e("p",[s._v("验证数据同步")])]),s._v(" "),e("p",[s._v("三台机器分别进入 "),e("code",[s._v("redis-cli")]),s._v("，然后执行 "),e("code",[s._v("info replication")]),s._v(" 查看集群信息，可以看到主节点的 role 是 master，从节点是 slave。")]),s._v(" "),e("p",[s._v("然后从主节点执行 "),e("code",[s._v("set a 111")]),s._v("，从 2 个从节点执行 "),e("code",[s._v("get a")]),s._v("，查看是否能查到数据；然后从两个从节点执行 "),e("code",[s._v("set b 222")]),s._v("，会提示没有写权限。")]),s._v(" "),e("h2",{attrs:{id:"哨兵模式安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#哨兵模式安装"}},[s._v("#")]),s._v(" 哨兵模式安装")]),s._v(" "),e("blockquote",[e("p",[s._v("Redis 一共三种集群模式，分别为 主从、哨兵、集群(分片);")]),s._v(" "),e("p",[s._v("哨兵模式安装需要先完成主从模式安装，"),e("strong",[s._v("见前面主从复制安装")])])]),s._v(" "),e("p",[s._v("哨兵模式就是在主从复制基础上添加了哨兵机制，实现了主从节点的自动切换。哨兵就是个脚本，包含在 Redis 代码内。")]),s._v(" "),e("p",[s._v("哨兵模式集群最少需要 3 台服务器，因为哨兵的选举机制需要按照少数服从多数原则进行选举主节点。")]),s._v(" "),e("ol",[e("li",[s._v("哨兵配置")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 哨兵的配置文件是 sentinel.conf")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 端口默认为26379。")]),s._v("\nport:26379\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭保护模式，可以外部访问。")]),s._v("\nprotected-mode:no\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置为后台启动。")]),s._v("\ndaemonize:yes\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志文件。")]),s._v("\nlogfile:./sentinel.log\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定主机IP地址和端口，并且指定当有2台哨兵认为主机挂了，则对主机进行容灾切换。")]),s._v("\nsentinel monitor mymaster "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.1 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当在Redis实例中开启了requirepass，这里就需要提供密码。")]),s._v("\nsentinel auth-pass mymaster "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里设置了主机多少秒无响应，则认为挂了。")]),s._v("\nsentinel down-after-milliseconds mymaster "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主备切换时，最多有多少个slave同时对新的master进行同步，这里设置为默认的1。")]),s._v("\nsentinel parallel-syncs mymaster "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 故障转移的超时时间，这里设置为三分钟。")]),s._v("\nsentinel failover-timeout mymaster "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("180000")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("防火墙配置")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 放行26379 端口")]),s._v("\nfirewall-cmd --add-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("26379")]),s._v("/tcp --permanent --zone"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启防火墙(修改配置后要重启防火墙)")]),s._v("\nfirewall-cmd --reload\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("ol",{attrs:{start:"3"}},[e("li",[s._v("启动哨兵")])]),s._v(" "),e("p",[e("code",[s._v("redis-sentinel ../sentinel.conf")])]),s._v(" "),e("p",[s._v("按照以上步骤将另外2台服务器的哨兵也配置下。")]),s._v(" "),e("ol",{attrs:{start:"4"}},[e("li",[s._v("哨兵信息查看")])]),s._v(" "),e("p",[s._v("执行 "),e("code",[s._v("redis-cli -p 26379")]),s._v(" 进入客户端，然后执行 "),e("code",[s._v("info sentinel")]),s._v(" 查看哨兵信息。")]),s._v(" "),e("ol",{attrs:{start:"5"}},[e("li",[s._v("验证容灾（自动切换）")])]),s._v(" "),e("p",[s._v("停止主节点服务，然后查看会不会自动选举出新的主节点；")]),s._v(" "),e("p",[s._v("将原来的主节点重新启动，会发现他会自动变成从节点。")]),s._v(" "),e("h2",{attrs:{id:"讨论区"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#讨论区"}},[s._v("#")]),s._v(" 讨论区")]),s._v(" "),e("blockquote",[e("p",[s._v("由于评论过多会影响页面最下方的导航，故将评论区做默认折叠处理。")])]),s._v(" "),e("details",{staticClass:"custom-block details"},[e("summary",[s._v("点击查看评论区内容，渴望您的宝贵建议~")]),s._v(" "),e("Vssue",{attrs:{title:s.$title,options:{locale:"zh"}}})],1)])}),[],!1,null,null,null);a.default=n.exports}}]);